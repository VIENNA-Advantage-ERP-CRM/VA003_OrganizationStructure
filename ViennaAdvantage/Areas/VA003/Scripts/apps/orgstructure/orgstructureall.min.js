/***version 1.0.7.0*/
VA003=window.VA003||{},function(n,t){function i(){function ff(){br=t('<a href="javascript:void(0)"  class="vis-icon-menuclose vis vis-mark"><\/a>');var n=t("<p>"+VIS.Msg.getMsg("VA003_OrgStructure")+" <\/p>");vt.append(uf.append(br).append(n));br.click(function(n){y.frame&&y.frame.dispose();y=null;n.stopPropagation()})}function ef(){ii=t('<div style="padding: 0px;border-right: white;" class="VA003-left-tree-wrap">');ot.append(t('<div class="VA003-left-tree" style="padding: 0px;overflow:auto">').append(ii)).append(t('<div class="VA003-div-reportgeneratediv">').append(ei).append(ni).append(rf));var n=ot.outerHeight()-(kt.outerHeight()+ei.outerHeight()+130);ii.parent().height(n)}function of(){i=t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>');i[0].style.visibility="hidden";vt.append(i)}function sf(){var n=t('<div class="VA003-rightinnerwrapper">'),r,i;s.append(n);r=t("<div>");uu=t('<ul class="VA003-topRight-icons">');pr=t('<li><a  style="padding:0px" ><span style="height:31px;width:31px" class="VA003-Refresh-icon vis vis-refresh"><\/span><\/a><\/li>');dt=t('<li><a  style="padding:0px" title="'+VIS.Msg.getMsg("VA003_AddNode")+'"><span style="height:31px;width:31px" class="VA003-AddNode-icon vis vis-tl-2"><\/span><\/a><\/li>');ci=t('<li><a style="padding:0px" title="'+VIS.Msg.getMsg("VA003_AddTree")+'"><span style="height:31px;width:31px" class="VA003-AddTree-icon vis vis-plus"><\/span><\/a><\/li>');fr=t('<li ><a style="padding:0px" title="'+VIS.Msg.getMsg("VA003_ExpandTree")+'"><span style="height:31px;width:31px" class="VA003-Expand-icon"><\/span><\/a><\/li>');uu.append(pr).append(ci).append(dt).append(fr);n.append(t('<div class="VA003-right-top">').append("<h4>"+VIS.Msg.getMsg("VA003_ReportingHierarchy")+"<\/h4>"));vt.append(s);i=t('<div class="VA003-righttopdatawrap">');gu=t('<div class="VA003-form-data-drp">');n.append(i);i.append(gu.append(b)).append(r.append(uu));o=t('<div style="float:left;width:100%" id="'+y.windowNo+'orgrighttree">');n.append(o);lr()}function hf(){yi=t('<ul  class="vis-apanel-rb-ul">');yi.append('<li data-action="zoom" title='+VIS.Msg.getMsg("Zoom")+' style="opacity: 1"><i data-action="zoom" class="vis vis-find"><\/i><\/li>');yi.append('<li data-action="refresh"  title='+VIS.Msg.getMsg("Refresh")+' ><i data-action="refresh" class="vis vis-refresh"><\/i><\/li>')}function cf(){a.on("click",function(){a.css("opacity")!="0.5"&&(nr(),he())});v.on("click",function(){v.css("opacity")!="0.5"&&(nr(),ce())});nt.on("click",function(){nt.css("opacity")!="0.5"&&(nr(),le())});wi.on("change",function(){ou()});yt.on("click",di);pt.on("click",gi);hi.on("change",yu);yr.on("click",vf);u.on("click",ae);f.on("click",ve);ei.on("click",ye);b.on("change",pu);dt.on("click",be);pr.on("click",pu);ci.on("click",de);gt.on("click",ke);rf.on("click",ou);wr.on("click",ge);ni.on("click",bf);fr.on("click",kf);h.on("change",function(){h.val().length>0?h.removeClass("vis-ev-col-mandatory"):h.addClass("vis-ev-col-mandatory")});rr.on("click",yf);p.on("change",lf);yi.on(VIS.Events.onTouchStartOrClick,"LI",pf)}function lf(){var u,n,i;p.prop("checked")?(i=r.data("kendoTreeView").parent(r.data("kendoTreeView").select()),parent&&t(i.find(".data-id")[0]).data("active")==!1&&(et(!0),ft=!1,VIS.ADialog.info("VA003_SetActive"),p.prop("checked",!1))):(u=r.data("kendoTreeView").select(),n=r.data("kendoTreeView").select().find(".k-group").find(".data-id"),af(n)||(et(!0),ft=!1,VIS.ADialog.info("VA003_SetInActive"),p.prop("checked",!0)))}function af(n){var r=!0,i;if(n!=null&&n.length>0)for(i=0;i<n.length;i++)if(t(n[i]).data("active")){r=!1;break}return r}function vf(){var i=at[0].files[0],n=!1,t;if(i?n=!0:l.attr("src")&&(n=!0),n){if(!VIS.ADialog.ask("DeleteIt"))return;t=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"OrgStructure/UpdateLogo",{AD_ORg_ID:c});t>0&&vi()}}function yf(){rr.w2overlay(yi.clone(!0))}function pf(n){var r=t(n.target).data("action");i[0].style.visibility="visible";r==VIS.Actions.refresh?t.ajax({url:VIS.Application.contextUrl+"OrgStructure/RefreshOrgType",async:!0,success:function(n){var r=JSON.parse(n),t;for(g.empty(),t=0;t<r.length;t++)g.append("<option value="+r[t].Key+">"+r[t].Name+"<\/option>");i[0].style.visibility="hidden"},error:function(n){console.log(n);i[0].style.visibility="hidden"}}):r==VIS.Actions.zoom&&bu(VIS.Utility.Util.getValueOfInt(g.val()),"Organization Type")}function wf(){var n,i;kt=t('<div class="VA003-top-buttons">');n=t(' <ul class="VA003-topLeft-icons">');v=t('<li><a title="'+VIS.Msg.getMsg("VA003_AddNode")+'" class="VA003-org-icon"><\/a><\/li>');a=t('<li><a title="'+VIS.Msg.getMsg("VA003_AddLegalEntity")+'" class="VA003-entity-icon"><\/a><\/li>');nt=t(' <li><a title="'+VIS.Msg.getMsg("VA003_AddOrgUnit")+'" class="VA003-orgUnit-icon"><\/a><\/li>');gt=t(' <li><a title="'+VIS.Msg.getMsg("Edit")+'" class="VA003-edit-icon"><\/a><\/li>');gr=t('<li class="VA003-shworgchkwrp"><\/li>');wi=t('<input type="checkbox" data-name="legal" >');tf=t("<li><label >"+VIS.Msg.getMsg("VA003_ShowOrgUnits")+"<\/label><\/li>");gr.append(wi).append(tf);wr=$btnHdrSend=t('<i class="VA003-InfoIcon vis vis-info" title="'+VIS.Msg.getMsg("VA003_info").replace("&","")+'"> <\/i>');uf.append(wr);n.append(v).append(a).append(nt).append(gt).append(gr);i=t('<ul class="VA003-topRight-icons">');pt=t('<li><a title="'+VIS.Msg.getMsg("VA003_Undo")+'"><span class="VA003-undo-icon vis vis-ignore"><\/span><\/a><\/li>');yt=t('<li><a title="'+VIS.Msg.getMsg("VA003_Save")+'"><span class="VA003-undo-icon vis vis-save"><\/span><\/a><\/li>');i.append(pt).append(yt);et(!0);kt.append(n).append(i);ot.append(kt);vt.append(ot)}function eu(){t.ajax({url:VIS.Application.contextUrl+"OrgStructure/GetTree",async:!0,data:{windowNo:y.windowNo,showOrgUnits:wi.is(":checked")},success:function(n){ii.append(r);iu=[];su(n)}})}function ou(){eu()}function bf(){ni.hasClass("VA003-expand")?(ni.removeClass("VA003-expand"),ni.addClass("VA003-collapase"),r.data("kendoTreeView").expand(".k-item"),ni.prop("title",VIS.Msg.getMsg("VA003_CollapseTree"))):(ni.removeClass("VA003-collapase"),ni.addClass("VA003-expand"),r.data("kendoTreeView").collapse(".k-item"),ni.prop("title",VIS.Msg.getMsg("VA003_ExpandTree")))}function kf(){var n=fr.find("span");n.hasClass("VA003-Expand-icon")?(n.removeClass("VA003-Expand-icon"),n.addClass("VA003-collapse-icon"),o.data("kendoTreeView").expand(".k-item"),n.prop("title",VIS.Msg.getMsg("VA003_CollapseTree"))):(n.removeClass("VA003-collapse-icon"),n.addClass("VA003-Expand-icon"),o.data("kendoTreeView").collapse(".k-item"),n.prop("title",VIS.Msg.getMsg("VA003_ExpandTree")))}function su(n){if(n==null||n==undefined)return null;var t=JSON.parse(n);tr=t[0].TableName;ir=t[0].AD_Tree_ID;r.data("kendoTreeView")!=undefined&&(r.data("kendoTreeView").destroy(),r.empty());r.kendoTreeView({dataSource:t,dragAndDrop:!0,drop:te,dragstart:ne,select:re,template:"<img src='"+VIS.Application.contextUrl+"#= item.ImageSource #' style='vertical-align: text-top;float: left;margin: 4px 0px 0px 10px;'><i class='#= item.ImageSource #'><\/i><p style='min-width:122px;border-radius:4px;margin:0px;padding: 7px 10px 7px 38px; background-color:#= item.bColor #; color: #= item.color #'>#= item.text #<\/p><input type='hidden' class='data-id' value='#= item.NodeID #' data-active='#= item.IsActive #' data-summary='#= item.IsSummary #' data-orgparentid='#= item.OrgParentID #' data-parentid='#= item.ParentID #'   data-legal='#= item.IsLegal #' data-isorgunit='#= item.IsOrgUnit #' data-Treeparentid='#= item.TreeParentID #' data-treeid='"+ir+"' />"});r.data("kendoTreeView").select(".k-first");window.setTimeout(function(){r.find(".k-in").css({cursor:"pointer"})},100);y.sizeChanged();k(!0);lu();wt(!1);i[0].style.visibility="hidden"}function df(){var r,n,a,i,e;ti=t('<div class="VA003-form-wrap vis-formouterwrpdiv">');var o=t('<div class="VA003-forminnerwrap">'),s=t('<div class="VA003-form-top">'),c=t('<div class="VA003-form-top-fields">');o.append(s);ri=t('<label class="VA003-formheadingwrap">'+VIS.Msg.getMsg("VA003_OrgInfo")+"<\/label>");ti.append(o.append(s.append(t('<div class="VA003-form-data"><\/div>').append(ri)).append(c)));tt=t('<input type="text" data-name="searchkey">');c.append(t('<div class="VA003-form-data input-group vis-input-wrap">').append(t('<div class="vis-control-wrap">').append(tt).append("<label>"+VIS.Msg.getMsg("SearchKey")+"<\/label>")));ut(tt);h=t('<input type="text" data-name="name">');c.append(t(' <div class="VA003-form-data input-group vis-input-wrap">').append(t('<div class="vis-control-wrap">').append(h).append("<label>"+VIS.Msg.getMsg("Name")+"<\/label>")));ut(h);r=t('<div class="VA003-image-wrap">');l=t('  <img src="'+VIS.Application.contextUrl+'Areas/VA003/Images/orgstr-org-logo.png" alt="Organization Logo">');r.append(t('<span class="VA003-image-area">').append(l));hi=t('<a><span class="vis vis-pencil" style="cursor: pointer;"><input type="file" style="position: absolute; top: 0px; right: 0px; opacity: 0;cursor: pointer;"><\/span><\/a>');yr=t('<a class="vis vis-cross" style="cursor:pointer"><\/a>');at=hi.find("input");r.append(t('<div class="VA003-image-upload">').append(t(' <div class="VA003-imageuploadinner"> <\/div>').append(hi).append(yr)));s.append(r);n=t('<div class="VA003-form-fullFields">');o.append(n);a=new VIS.MLocationLookup(vr,y.windowNo);w=new VIS.Controls.VLocation("C_Location_ID",!1,!1,!0,VIS.DisplayType.Location,a);t(w.getControl()).data("name","address");n.append(t('<div class="VA003-form-data input-group vis-input-wrap">').append(t('<div class="vis-control-wrap">').append(w.getControl().attr("data-hasbtn"," ").addClass("VA003-addressControl")).append("<label>"+VIS.Msg.getMsg("Address")+"<\/label>")).append(t('<div class="input-group-append">').append(w.getBtn(0)).append(w.getBtn(1))));w.fireValueChanged=gf;rr=t('<button tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i tabindex="-1" class="fa fa-ellipsis-v"><\/i><\/button>');g=t('<select data-name="orgtype" data-hasbtn=" ">');n.append(t(' <div class="VA003-form-data input-group vis-input-wrap">').append(t('<div class="vis-control-wrap">').append(g).append("<label>"+VIS.Msg.getMsg("VA003_OrgType")+"<\/label>")).append(t('<div class="input-group-append">').append(rr)));ut(g);st=t('<input type="text" data-name="taxid">');n.append(t(' <div class="VA003-form-data input-group vis-input-wrap">').append(t('<div class="vis-control-wrap">').append(st).append("<label>"+VIS.Msg.getMsg("VA003_TaxID")+"<\/label>")));ut(st);ht=t('<input type="text" data-name="phone">');n.append(t(' <div class="VA003-form-data input-group vis-input-wrap">').append(t('<div class="vis-control-wrap">').append(ht).append("<label>"+VIS.Msg.getMsg("Phone")+"<\/label>")));ut(ht);ct=t('<input type="text"  data-name="email">');n.append(t(' <div class="VA003-form-data input-group vis-input-wrap">').append(t('<div class="vis-control-wrap">').append(ct).append("<label>"+VIS.Msg.getMsg("EMail")+"<\/label>")));ut(ct);lt=t('<input type="text" data-name="fax">');n.append(t(' <div class="VA003-form-data input-group vis-input-wrap">').append(t('<div class="vis-control-wrap">').append(lt).append("<label>"+VIS.Msg.getMsg("Fax")+"<\/label>")));ut(lt);i=t(' <div class="VA003-form-data">');u=t('<input type="checkbox" data-name="legal">');i.append(t(' <div style="width:50%; margin-bottom: 15px"  class="VA003-form-data">').append(u).append("<label>"+VIS.Msg.getMsg("VA003_LegalEntity")+"<\/label>"));ut(u);f=t('<input type="checkbox" data-name="summary">');i.append(t(' <div style="width:50%; margin-bottom: 15px" class="VA003-form-data">').append(f).append("<label>"+VIS.Msg.getMsg("VA003_SummaryLevel")+"<\/label>"));ut(f);it=t('<input type="checkbox" data-name="summary">');ui=t(' <div style="width:50%; margin-bottom: 15px" class="VA003-form-data">').append(it).append("<label>"+VIS.Msg.translate(VIS.Env.getCtx(),"IsCostCenter")+"<\/label>");i.append(ui);ut(it);rt=t('<input type="checkbox" data-name="summary">');fi=t(' <div style="width:50%; margin-bottom: 15px" class="VA003-form-data">').append(rt).append("<label>"+VIS.Msg.translate(VIS.Env.getCtx(),"IsProfitCenter")+"<\/label>");i.append(fi);ut(rt);n.append(i);e=t(' <div class="VA003-form-data">');p=t('<input type="checkbox" data-name="Active">');e.append(t(' <div style="width:50%" class="VA003-form-data">').append(p).append("<label>"+VIS.Msg.getMsg("VA003_Active")+"<\/label>"));ut(p);p.prop("checked",!0);n.append(e);ot.append(ti)}function oi(n){n?ri.text(VIS.Msg.getMsg("VA003_AddOrg")):ri.text(VIS.Msg.getMsg("VA003_OrgInfo"))}function gf(){ft=!0;et(!1)}function ne(n){if(ft){n.preventDefault();window.setTimeout(function(){VIS.ADialog.ask("VA003_SaveExisting")?di():gi()},200);ft=!1;return}}function te(n){var c,y,p,w,k,d,l,f,s,u;if(!n.valid){n.preventDefault();return}if(n.dropPosition=="before"){n.preventDefault();return}if(n.dropPosition=="after"){n.preventDefault();return}if(c=t(n.sourceNode).find(".data-id").data("summary"),y=t(n.sourceNode).find(".data-id").data("isorgunit")?"'Y'":"'N'",ai!=null&&ai.length>0&&ai.contains("IsOrgUnit")){if(p=ai.substring(ai.indexOf("=")+1),y!=p){n.preventDefault();return}}else if(t(n.sourceNode).find(".data-id").data("isorgunit")){n.preventDefault();return}if(w=t(n.destinationNode).find(".data-id").data("treeid"),k=t(n.sourceNode).find(".data-id").data("treeid"),k!=w){if(d=t(n.sourceNode).find(".data-id").data("active"),!d)return n.preventDefault(),!1;n.preventDefault();t(n.destinationNode).find(".data-id").data("summary")&&(ie(this,n),b.trigger("change"));return}if(l=t(n.sourceNode).find(".data-id").data("legal"),t(n.destinationNode).find(".data-id").data("summary")!=!0&&l==!0){n.preventDefault();return}if(f=t(n.destinationNode).find(".data-id").data("summary"),c&&!f){n.preventDefault();return}var g=t(n.sourceNode).find(".data-id").data("treeid"),a=t(n.sourceNode).find(".data-id").val(),v=t(n.sourceNode).find(".data-id").data("treeparentid"),e=t.grep(iu,function(n){return n.id==a});if(e!=undefined&&e!=null&&e.length>0&&(v=e[0].pid),s=t(n.destinationNode).find(".data-id").val(),f&&(s=0),u=0,t(n.destinationNode).find(".data-id").data("summary")==!0?u=t(n.destinationNode).find(".data-id").val():u==0&&f&&(u=t(n.destinationNode).find(".data-id").val()),v==u&&f&&t(n.destinationNode).find(".data-id").val()>0){n.preventDefault();return}t(n.sourceNode).find(".data-id")[0].setAttribute("data-treeparentid",u);e!=undefined&&e!=null&&e.length>0?e[0].pid=u:iu.push({id:a,pid:u});t(n.sourceNode).find(".data-id").data("orgparentid",s);f?(s=0,t(n.sourceNode).find(".data-id").data("parentid",parseInt(u))):t(n.sourceNode).find(".data-id").data("parentid",0);i[0].style.visibility="visible";var h=t(n.sourceNode).siblings(),tt=t(n.destinationNode),o=t(n.destinationNode).children("ul").children(),nt=t(n.sourceNode).find(".data-id").data("active");o==null||o==""||o.length==0?window.setTimeout(function(){o=tt.children("ul").children();au(h,v,o,u,g,f,a,s,!0);r.data("kendoTreeView").trigger("select",{node:t(n.sourceNode)});hu(l,c,nt,t(n.sourceNode))},200):window.setTimeout(function(){o=t(n.destinationNode).children("ul").children();h.length==1&&h.find(".data-id").val()==u&&(h=[]);au(h,v,o,u,g,f,a,s,!0);r.data("kendoTreeView").trigger("select",{node:t(n.sourceNode)});hu(l,c,nt,t(n.sourceNode))},200)}function hu(n,i,u,f){var o=r.data("kendoTreeView").findByUid(f.data("uid"));r.data("kendoTreeView").select(o);n?u?(t(e.sourceNode).data("uid"),t(r.data("kendoTreeView").select().find("p")[0]).css("background-color","#dc8a20")):t(r.data("kendoTreeView").select().find("p")[0]).css("background-color","#F4C993"):i?u?t(r.data("kendoTreeView").select().find("p")[0]).css("background-color","#0084c4"):t(r.data("kendoTreeView").select().find("p")[0]).css("background-color","rgba(0, 132, 196, 0.7)"):u?t(r.data("kendoTreeView").select().find("p")[0]).css("background-color","rgba(43, 174, 250, 0.78)"):t(r.data("kendoTreeView").select().find("p")[0]).css("background-color","rgba(166, 222, 255, 1)")}function cu(n){var u,f,l,s,r,e;if(!n.valid){n.preventDefault();return}if(n.dropPosition=="before"&&t(n.destinationNode).find(".data-id").val()==0){n.preventDefault();return}if(u=!1,n.dropPosition=="before"?u=!0:n.dropPosition=="after"&&(u=!0),f=t(n.destinationNode).find(".data-id").data("summary"),!f&&!u){n.preventDefault();return}if(l=t(n.sourceNode).find(".data-id").data("legal"),l&&!f&&!u){n.preventDefault();return}if(s=t(n.sourceNode).find(".data-id").data("summary"),s&&!f){n.preventDefault();return}var v=t(n.sourceNode).find(".data-id").data("treeid"),h=t(n.sourceNode).find(".data-id").val(),o=t(n.sourceNode).find(".data-id").data("treeparentid");if(o==0&&s&&(o=t(n.sourceNode).find(".data-id").val()),r=t.grep(ru,function(n){return n.id==h}),r!=undefined&&r!=null&&r.length>0&&(o=r[0].pid),e=0,e=u?t(n.destinationNode).find(".data-id").data("treeparentid"):t(n.destinationNode).find(".data-id").val(),o==e&&!u){n.preventDefault();return}r!=undefined&&r!=null&&r.length>0?r[0].pid=e:ru.push({id:h,pid:e});i[0].style.visibility="visible";var a=t(n.sourceNode).siblings(),y=t(n.destinationNode),c=t(n.destinationNode).children("ul").children();window.setTimeout(function(){f&&(c=t(n.destinationNode).children("ul").children());u&&(c=t(n.destinationNode).parent().children("li"));a=[];fe(a,o,c,e,v,f,h,null,!1)},200)}function ie(n,i){var l=n.dataItem(i.sourceNode).toJSON(),a=t(i.destinationNode),v=t(i.sourceNode).find(".data-id").val(),c=t(i.destinationNode).find(".data-id").val(),s=t(i.destinationNode).find(".data-id").data("treeid"),u=t(t(i.sourceNode).find(".data-id")[0]),h=0,f,e,o,r;try{f=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"OrgStructure/LoadSequenceforTree",{TreeId:s});f!=null&&(h=f)}catch(y){}for(e=[],o=[],r=0;r<u.length;r++)e[r]=t(u[r]).val(),o[r]=t(u[r]).data("active")==!0?"Y":"N";VIS.dataContext.getJSONData(VIS.Application.contextUrl+"OrgStructure/InsertTreeNode",{Chidrens:e,IsActive:o,ParentID:c,TreeIds:s,ChildCount:VIS.Utility.Util.getValueOfInt(h)})}function re(n){var o,u,e,s;if(ft)if(VIS.ADialog.ask("VA003_SaveExisting")){if(o=di(),!o){n.preventDefault();return}}else gi();ri.text(VIS.Msg.getMsg("VA003_OrgInfo"));u=t(n.node).find(".data-id");e=u.val();i[0].style.visibility="visible";e>0?(ue(),k(!1),oe(e,!1),tu=!1,wt(!1)):(lu(),k(!0),tu=!0,si(),er(),wt(!1),i[0].style.visibility="hidden");s=u.data("orgparentid");s>0&&f.prop("disabled",!0);li=u.data("summary");(!li||u.data("legal"))&&(a.prop("disabled",!0),a.css("opacity","0.5"));li||u.data("legal")||(nt.prop("disabled",!0),nt.css("opacity","0.5"));li?(v.prop("disabled",!1),v.css("opacity","1")):(v.prop("disabled",!0),v.css("opacity","0.5"));li?(d=u.val(),bt=0):(d=u.data("treeparentid"),bt=u.val());(d=="undefined"||d==null||d==undefined)&&(d=0);window.setTimeout(function(){r.find(".k-in").css({cursor:"pointer"});r.find(".k-state-focused.k-state-selected").css({"box-shadow":"none","-webkit-box-shadow":"none"})},100)}function lu(){a.prop("disabled",!1);a.css("opacity","1");nt.prop("disabled",!1);nt.css("opacity","1");h.attr("disabled",!0);tt.attr("disabled",!0);u.attr("disabled",!0);f.attr("disabled",!0);p.attr("disabled",!0);si();vi()}function ue(){a.prop("disabled",!1);a.css("opacity","1");nt.prop("disabled",!1);nt.css("opacity","1");h.attr("disabled",!1);tt.attr("disabled",!1);p.attr("disabled",!1);u.attr("disabled",!1);f.attr("disabled",!1)}function au(n,r,u,f,e,o,s,h){for(var a,v,l=[],y=[],c=0;c<n.length;c++)l[c]=VIS.Utility.Util.getValueOfInt(t(n[c]).find(".data-id").val());for(c=0;c<u.length;c++)y[c]=t(u[c]).find(".data-id").val();a=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"OrgStructure/UpdateSequence",{TableName:tr,OldID:r,NewId:f,TreeId:e,OldSibling:l,NodId:NodeIds});v=f;VIS.dataContext.getJSONData(VIS.Application.contextUrl+"OrgStructure/UpdateParentNode",{TreeId:e,CurrentNode:s,NewIdForOrg:h,IsSummery:o});i[0].style.visibility="hidden"}function fe(n,r,u,f,e){for(var h,c,n=[],s=[],o=0;o<n.length;o++)n[o]=VIS.Utility.Util.getValueOfInt(t(n[o]).find(".data-id").val());for(o=0;o<u.length;o++)s[o]=t(u[o]).find(".data-id").val();h=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"OrgStructure/UpdateSequence",{TableName:tr,OldID:r,NewId:f,TreeId:e,OldSibling:n,NodId:s});c=f;console.log(s);i[0].style.visibility="hidden"}function ee(){t.ajax({url:VIS.Application.contextUrl+"OrgStructure/LoadLookups",success:function(n){var t=JSON.parse(n);t&&nf==!1&&(se(t.AllOrgType,t.AllReportHierarchy,t),nf=!0)}})}function oe(n,r){t.ajax({url:VIS.Application.contextUrl+"OrgStructure/GetOrgInfo",async:!0,data:{orgID:n,loadLookups:r},success:function(n){var t=JSON.parse(n);c=t.OrgID;bt=c;vu(t,!0);i[0].style.visibility="hidden"},error:function(n){VIS.ADialog.error("VA003_ErrorgettingOrg"+n);i[0].style.visibility="hidden"}})}function se(n,t,i){if(n)for(var r=0;r<n.length;r++)g.append("<option value="+n[r].Key+">"+n[r].Name+"<\/option>");ar(t);h.attr("maxlength",i.NameLength);tt.attr("maxlength",i.ValueLength);ct.attr("maxlength",i.EMailLength);lt.attr("maxlength",i.FaxLength);ht.attr("maxlength",i.PhoneLength);st.attr("maxlength",i.TaxIDLength);ur=i.NameLength;kr=i.ValueLength;dr=i.TreeNameLength}function vu(n,i){f.attr("disabled",!1);nu||u.attr("disabled",!1);n==null||n==undefined?(tt.val(""),h.val(""),st.val(""),ct.val(""),ht.val(""),lt.val(""),w.setValue(null),u.prop("checked",!1),g.val(-1),f.prop("checked",!1),k(!1),vi(),wt(!0)):(tt.val(n.SearchKey),h.val(n.Name),g.val(n.OrgType),st.val(n.TaxID),ct.val(n.EmailAddess),ht.val(n.Phone),lt.val(n.Fax),n.C_Location_ID==0?w.setValue(null):w.setValue(n.C_Location_ID),n.IsLegalEntity!=null&&n.IsLegalEntity!=""?(u.prop("checked",n.IsLegalEntity),k(!1)):(u.prop("checked",!1),k(!1)),n.IsSummary!=null&&n.IsSummary!=""?(f.prop("checked",n.IsSummary),k(!0)):(f.prop("checked",!1),k(!1)),n.ParentOrg>0?(u.prop("disabled",!0),f.prop("disabled",!0),nu=!0):(u.prop("disabled",!1),f.prop("disabled",!1),nu=!1),n.IsActive?p.prop("checked",n.IsActive):p.prop("checked",!1),n.profitCenter!=undefined&&n.profitCenter!=null&&n.profitCenter!=""?rt.prop("checked",n.profitCenter):rt.prop("checked",!1),n.costCenter!=undefined&&n.costCenter!=null&&n.costCenter!=""?it.prop("checked",n.costCenter):it.prop("checked",!1),n.OrgImage!=null&&n.OrgImage!=undefined&&n.OrgImage.length>0?(l.show(),t(l.parent()).css("background-color","white"),l.attr("src",VIS.Application.contextUrl+n.OrgImage)):vi(),i&&er(n),wt(!1))}function vi(){t(l.parent()).css("background-color","rgba(var(--v-c-secondary), .4)");l.attr("src",null);l.hide()}function er(n){bi=n?{Tenant:n.Tenant,SearchKey:n.SearchKey,Name:n.Name,TaxID:n.TaxID,EmailAddess:n.EmailAddess,Phone:n.Phone,Fax:n.Fax,C_Location_ID:n.C_Location_ID,IsSummary:n.IsSummary,IsLegalEntity:n.IsLegalEntity,OrgImage:n.OrgImage,IsActive:n.IsActive,costCenter:n.costCenter,profitCenter:n.profitCenter}:{Tenant:"",SearchKey:"",Name:"",TaxID:"",EmailAddess:"",Phone:"",Fax:"",C_Location_ID:"",IsSummary:"",IsLegalEntity:"",OrgImage:"",IsActive:"",costCenter:"",profitCenter:""}}function he(){var n=or();n||(et(!1),sr(),hr(a),si(),wt(!0),oi(!0),k(!1),f.attr("disabled",!0),u.attr("disabled",!0),f.prop("checked",!1),u.prop("checked",!0),it.prop("checked",!1),rt.prop("checked",!1),ui.hide(),fi.hide())}function ce(){var n=or();n||(et(!1),hr(v),si(),oi(!0),sr(),k(!0),wt(!0),f.attr("disabled",!0),u.attr("disabled",!0),f.prop("checked",!0),u.prop("checked",!1),it.prop("checked",!1),rt.prop("checked",!1),ui.hide(),fi.hide())}function or(){return ft?(VIS.ADialog.ask("VA003_SaveExisting")?di():gi(),ft=!1,!0):!1}function le(){var n=or();n||(et(!1),sr(),hr(nt),si(),wt(!0),oi(!0),f.attr("disabled",!0),u.attr("disabled",!0),f.prop("checked",!1),u.prop("checked",!1),k(!1),it.prop("checked",!1),rt.prop("checked",!1),ui.show(),fi.show())}function sr(){h.attr("disabled",!1);tt.attr("disabled",!1)}function hr(n){var t={to:ti,className:"VA003-ui-effects-transfer"};n.effect("transfer",t,600,function(){});at.val("")}function si(){c=0;tt.val("");h.val("");g.val(-1);ct.val("");ht.val("");lt.val("");st.val("");w.setValue(null);u.attr("checked",!1);f.attr("checked",!1);p.prop("checked",!0);vi()}function wt(n){n?h.addClass("vis-ev-col-mandatory"):tu||h.removeClass("vis-ev-col-mandatory")}function k(n){g.attr("disabled",n);ct.attr("disabled",n);ht.attr("disabled",n);lt.attr("disabled",n);st.attr("disabled",n);w.getControl().attr("disabled",n);w.getBtn(0).attr("disabled",n);w.getBtn(1).attr("disabled",n);u.is(":checked")||f.is(":checked")?(it.attr("hidden",!0),rt.attr("hidden",!0),ui.attr("hidden",!0),fi.attr("hidden",!0),it.prop("checked",!1),rt.prop("checked",!1)):(it.attr("hidden",!1),rt.attr("hidden",!1),ui.attr("hidden",!1),fi.attr("hidden",!1));var t="white";n&&(t="#F4F4F4")}function ut(n){if(n.is(":text"))n.on("keydown",function(){ft=!0;et(!1)});else n.on("change",function(){ft=!0;et(!1)})}function di(){if(yt.css("opacity")!="0.5"){if(h.val().trim().length==0){VIS.ADialog.info("EnterName");return}ft=!1;d==c&&(d=0);i[0].style.visibility="visible";window.setTimeout(function(){var n={OrgID:c,Tenant:vr.getAD_Client_ID(),SearchKey:VIS.Utility.encodeText(tt.val().trim()),Name:VIS.Utility.encodeText(h.val().trim()),C_Location_ID:w.getValue(),TaxID:VIS.Utility.encodeText(st.val().trim()),EmailAddess:VIS.Utility.encodeText(ct.val().trim()),Phone:VIS.Utility.encodeText(ht.val().trim()),Fax:VIS.Utility.encodeText(lt.val().trim()),OrgType:g.val(),IsActive:p.is(":checked"),IsSummary:f.is(":checked"),IsLegalEntity:u.is(":checked"),ParentIDForSummary:d,AD_Tree_ID:ir,showOrgUnit:wi.is(":checked"),costCenter:it.is(":checked"),profitCenter:rt.is(":checked")};c!=0||bi==null||bi.IsSummary||(n.ParentOrg=bt);t.ajax({url:VIS.Application.contextUrl+"OrgStructure/InsertOrUpdateOrg",async:!0,data:n,success:function(e){var o,s,b;if(e){if(JSON.parse(e)=="VIS_OrgExist"){VIS.ADialog.warn("VA003_OrgExist");i[0].style.visibility="hidden";return}if(JSON.parse(e).indexOf("Error")>-1){VIS.ADialog.warn(JSON.parse(e));i[0].style.visibility="hidden";return}if(o=p.is(":checked"),c==0){c=parseInt(JSON.parse(e));s={};s.color="white";s.NodeID=c;s.text=VIS.Utility.encodeText(h.val());s.IsSummary=!1;var l=f.is(":checked"),g=u.is(":checked"),y="",w="",nt=r.data("kendoTreeView").select();u.is(":checked")?(y=o?"#dc8a20":"#F4C993",w="Areas/VA003/Images/orgstr-legal-entity.PNG"):f.is(":checked")?(y=o?"#0084c4":"rgba(0, 132, 196, 0.7)",w="Areas/VA003/Images/orgstr-org.png"):(y=o?"rgba(43, 174, 250, 0.78)":"rgba(166, 222, 255, 1)",w="Areas/VA003/Images/orgstr-store.PNG");(!l||g)&&(a.prop("disabled",!0),a.css("opacity","0.5"));l?(v.prop("disabled",!1),v.css("opacity","1")):(v.prop("disabled",!0),v.css("opacity","0.5"));l?(d=c,bt=0):(d=d,bt=c);b=r.data("kendoTreeView").append({text:VIS.Utility.encodeText(h.val()),bColor:y,color:"white",NodeID:c,IsSummary:l,ImageSource:w,ParentID:bt,TreeParentID:d,OrgParentID:parseInt(bt),IsLegal:g,IsActive:o},nt);r.data("kendoTreeView").select(b);r.data("kendoTreeView").trigger("select",{node:b});yu();rt.prop("checked",!1);it.prop("checked",!1);VIS.ADialog.info("Saved");i[0].style.visibility="hidden"}else ki?(su(e),si(),k(!0),i[0].style.visibility="hidden"):(VIS.ADialog.info("Saved"),u.is(":checked")?o?t(r.data("kendoTreeView").select().find("p")[0]).css("background-color","#dc8a20"):t(r.data("kendoTreeView").select().find("p")[0]).css("background-color","#F4C993"):f.is(":checked")?o?t(r.data("kendoTreeView").select().find("p")[0]).css("background-color","#0084c4"):t(r.data("kendoTreeView").select().find("p")[0]).css("background-color","rgba(0, 132, 196, 0.7)"):o?t(r.data("kendoTreeView").select().find("p")[0]).css("background-color","rgba(43, 174, 250, 0.78)"):t(r.data("kendoTreeView").select().find("p")[0]).css("background-color","rgba(166, 222, 255, 1)"),o?t(t(r.data("kendoTreeView").select()).find(".data-id")[0]).data("active",!0):t(t(r.data("kendoTreeView").select()).find(".data-id")[0]).data("active",!1),i[0].style.visibility="hidden");ki=!1;er(n);et(!0)}oi(!1)},error:function(n){VIS.ADialog.error("VA003_ErrorInSaving"+n);oi(!1)}})},200)}}function gi(){pt.css("opacity")!="0.5"&&(ft=!1,vu(bi,!1),et(!0),oi(!1),wt(!1))}function et(n){pt.prop("disabled",n);yt.prop("disabled",n);n?(pt.css("opacity",".5"),yt.css("opacity",".5")):(pt.css("opacity","1"),yt.css("opacity","1"))}function yu(){var r,u,n,f;if(c>0){if(n=at[0].files[0],n!=null&&n!=undefined){if(n.size>51200){at.val("");VIS.ADialog.info("VA003_picSize");return}i[0].style.visibility="visible";r=new XMLHttpRequest;u=new FormData;u.append("pic",n);u.append("orgID",c);r.open("POST",VIS.Application.contextUrl+"OrgStructure/UploadPic");r.send(u);r.addEventListener("load",function(n){var r=n.target.response,u=JSON.parse(r),f=JSON.parse(u);l.show();t(l.parent()).css("background-color","white");l.attr("src",VIS.Application.contextUrl+f);i[0].style.visibility="hidden"})}at.val("")}else if(n=at[0].files[0],n){if(n.size>51200){at.val("");VIS.ADialog.info("VA003_picSize");return}f=new FileReader;f.onloadend=function(){l.show();t(l.parent()).css("background-color","white");l.attr("src",f.result)};f.readAsDataURL(n)}}function ae(){c>0&&(f.is(":checked")&&f.prop("checked",!1),ki=!0);k(u.is(":checked"))}function ve(n){if(c>0){if(u.is(":checked")){if(!VIS.ADialog.ask("VA003_changeToSummary")){n.preventDefault();return}u.prop("checked",!1);ki=!0}else if(!li&&f.is(":checked")){if(!VIS.ADialog.ask("VA003_changeToSummary")){n.preventDefault();return}u.attr("checked",!1);ki=!0}f.is(":checked")?u.attr("disabled",!0):u.attr("disabled",!1)}k(f.is(":checked"))}function ye(){i[0].style.visibility="visible";window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"OrgStructure/GenerateHeirarchy",async:!0,data:{windowNo:y.windowNo},success:function(n){var t=JSON.parse(n),r,u;if(t!=null){if(t=="ProcessFailed"){VIS.ADialog.error("ProcessFailed");i[0].style.visibility="hidden";return}if(t=="ProcessNoInstance"){VIS.ADialog.error("ProcessNoInstance");i[0].style.visibility="hidden";return}if(jQuery.type(t)=="string"&&t.indexOf("Error")>-1){VIS.ADialog.error(t);i[0].style.visibility="hidden";return}r=t.AllReportHierarchy;ar(r);u=t.Tree;cr(u)}},error:function(n){console.log(n);VIS.ADialog.error("VA003_ControllerNotFound");i[0].style.visibility="hidden"}})},200)}function pu(){ru=[];var n=b.val();if(n<0){o.data("kendoTreeView")!=undefined&&(o.data("kendoTreeView").destroy(),o.empty());return}b.find("option:selected").data("isdefault")=="Y"?dt.css("opacity","0.5"):dt.css("opacity","1");i[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"OrgStructure/CreateTree",data:{windowNo:y.windowNo,treeID:n},success:function(n){treeData=JSON.parse(n);cr(treeData);b.find("option:selected").data("isdefault")=="N"&&o.data("kendoTreeView").expand(".k-item")},error:function(){VIS.ADialog.error("VA003_ControllerNotFound");i[0].style.visibility="hidden"}})}function cr(n){var r,u,f,e;o.data("kendoTreeView")!=undefined&&(o.data("kendoTreeView").destroy(),o.empty());r=b.find("option:selected").data("isdefault")=="Y"?!1:!0;u=n[0].AD_Tree_ID;ai=n[0].WhereClause;r?o.kendoTreeView({dataSource:n,dragAndDrop:r,drop:cu,select:wu,template:"<div style='float: left;border-radius: 4px;display: inline-flex; align-items: center; background: #= item.bColor #;'><img src='"+VIS.Application.contextUrl+"#= item.ImageSource #' style='vertical-align: text-top;float: left;margin: 0px 0px 0px 10px; '><i class='#= item.ImageSource #' style='float: left;'><\/i><p style='float: left;min-width:122px;border-radius:4px;margin:0px;padding: 7px 10px 7px 10px;  color: #= item.color #'>#= item.text #<\/p><input type='hidden' class='data-id' value='#= item.NodeID #'  data-legal='#= item.IsLegal #'  data-summary='#= item.IsSummary #'  data-parentid='#= item.ParentID #'  data-Treeparentid='#= item.TreeParentID #'   data-treeid='"+u+"' /><\/div><div style='float:left; display: flex; align-items: center;'><a style='display:#= item.DeleteVisibility #' title='"+VIS.Msg.getMsg("Delete")+"' class='VA003-delete-link vis vis-mark' ><\/a><a style='display:#= item.Visibility #' title='"+VIS.Msg.getMsg("VA003_Rename")+"'  class='VA003-rename-link vis vis-pencil' ><\/a><\/div>"}):o.kendoTreeView({dataSource:n,dragAndDrop:r,drop:cu,select:wu,template:"<div style='float: left;border-radius: 4px;float: left;border-radius: 4px;display: inline-flex; align-items: center;background: #= item.bColor #;'><img src='"+VIS.Application.contextUrl+"#= item.ImageSource #' style='vertical-align: text-top;float: left;margin: 0px 0px 0px 10px; '><i class='#= item.ImageSource #' style='float: left;'><\/i><p style='float: left;min-width:122px;border-radius:4px;margin:0px;padding: 7px 10px 7px 10px;  color: #= item.color #'>#= item.text #<\/p><input type='hidden' class='data-id' value='#= item.NodeID #'  data-legal='#= item.IsLegal #'  data-summary='#= item.IsSummary #'  data-parentid='#= item.ParentID #'  data-Treeparentid='#= item.TreeParentID #'   data-treeid='"+u+"' /><\/div><div style='float:left;display:#= item.Visibility #'><a title='"+VIS.Msg.getMsg("VA003_Rename")+"'  class='VA003-rename-link vis vis-pencil' ><\/a><\/div>"});o&&(f=t(s.find(".VA003-right-top")).outerHeight(),e=t(s.find(".VA003-form-data")).outerHeight(),o.height(s.outerHeight()-120));window.setTimeout(function(){o.find(".k-in").css({cursor:"pointer"})},100);s.off(VIS.Events.onTouchStartOrClick,".VA003-delete-link");s.on(VIS.Events.onTouchStartOrClick,".VA003-delete-link",we);s.off(VIS.Events.onTouchStartOrClick,".VA003-rename-link");s.on(VIS.Events.onTouchStartOrClick,".VA003-rename-link",pe);i[0].style.visibility="hidden"}function wu(){window.setTimeout(function(){o.find(".k-in").css({cursor:"pointer"})},100)}function pe(){var s=t(t(this).closest(".k-item")).find(".data-id").val(),u=o.data("kendoTreeView"),h=u.dataItem(u.select()).text,f=t('<div class="vis-formouterwrpdiv">'),e=t('<div style="width:100%" class="VA003-form-top-fields">'),r=t('<input  maxlength="'+ur+'" type="text" data-name="name" placeholder=" " data-placeholder="">'),n;r.val(h);r.select();e.append(t('<div class="VA003-form-data input-group vis-input-wrap">').append(t('<div class="vis-control-wrap">').append(r).append("<label>"+VIS.Msg.getMsg("Name")+"<\/label>")));f.append(e);n=new VIS.ChildDialog;n.setContent(f);n.setWidth("350px");n.setTitle(VIS.Msg.getMsg("VA003_RenameNode"));n.setModal(!0);n.onClose=function(){};n.show();n.onOkClick=function(){if(r.val().trim().length==0){VIS.ADialog.info("EnterName");return}i[0].style.visibility="visible";VIS.dataContext.getJSONData(VIS.Application.contextUrl+"OrgStructure/UpdateOrgnization",{Name:VIS.Utility.encodeText(r.val()),AD_Org_ID:s});var n=o.data("kendoTreeView");n.dataItem(n.select()).set("text",VIS.Utility.encodeText(r.val()));i[0].style.visibility="hidden"};n.onCancelClick=function(){}}function we(){var n,r,u;VIS.ADialog.ask("DeleteIt")&&(i[0].style.visibility="visible",n=o.data("kendoTreeView"),n.remove(t(this).closest(".k-item")),r=t(t(this).closest(".k-item")).find(".data-id").val(),u=t(t(this).closest(".k-item")).find(".data-id").data("treeid"),VIS.dataContext.getJSONData(VIS.Application.contextUrl+"OrgStructure/DeleteAD_TreeNode",{TreeId:u,Parent_ID:r}),i[0].style.visibility="hidden")}function be(){if(dt.css("opacity")!="0.5"){var t=o.data("kendoTreeView").select().find(".data-id").val(),i=new n.OrgStructure.AddNode(b.val(),y,t,ur,kr);i.show()}}function ke(){s.data("isexpanded")=="N"?(s.data("isexpanded","Y"),s.animate({width:"67%"},800,function(){gt.find("img").attr("src",VIS.Application.contextUrl+"Areas/VA003/Images/orgstr-toggle.png");lr()}),gt.find("a").removeClass("VA003-toggle-icon"),gt.find("a").addClass("VA003-edit-icon")):nr()}function nr(){s.data("isexpanded")=="Y"&&(s.data("isexpanded","N"),s.animate({width:"35%"},800,function(){gt.find("img").attr("src",VIS.Application.contextUrl+"Areas/VA003/Images/arrow-left.png");lr()}),gt.find("a").addClass("VA003-toggle-icon"),gt.find("a").removeClass("VA003-edit-icon"))}function lr(){}function de(){var r=t('<div class="vis-formouterwrpdiv">'),u=t('<div style="width:100%" class="VA003-form-top-fields">'),e=t('<div style="width:100%" class="VA003-form-top-fields">'),f=t('<input maxlength="'+dr+'" type="text" data-name="name" placeholder=" " data-placeholder="">'),o=t('<input type="checkbox" data-name="isorgunit">'),n;u.append(t('<div class="VA003-form-data input-group vis-input-wrap">').append(t('<div class="vis-control-wrap">').append(f).append("<label>"+VIS.Msg.getMsg("Name")+"<\/label>")));e.append(t('<div style="margin-bottom:15px" class="VA003-form-top-fields">').append(o).append("<label>"+VIS.Msg.getMsg("VA003_OrgUnitTree")+"<\/label>"));r.append(u);r.append(e);u.append(t('<div class="VA003-form-data input-group vis-input-wrap">').append(t('<div class="vis-control-wrap">').append(f).append("<label>"+VIS.Msg.getMsg("Name")+"<\/label>")));r.append(u);n=new VIS.ChildDialog;n.setContent(r);n.setWidth("350px");n.setTitle(VIS.Msg.getMsg("VA003_AddTree"));n.setModal(!0);n.onClose=function(){};n.show();n.onOkClick=function(n){if(f.val().trim().length==0)return VIS.ADialog.info("EnterName"),n.preventDefault(),!1;i[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"OrgStructure/AddNewTree",async:!0,data:{name:VIS.Utility.encodeText(f.val().trim()),IsOrgUnit:o.is(":checked")},success:function(n){var t=JSON.parse(n),r;if(t==null||t==undefined)return i[0].style.visibility="hidden",null;b.empty();r=t.AllReportHierarchy;ar(r)}})};n.onCancelClick=function(){}}function ar(n){var t,r;if(b.empty(),n)for(t=0;t<n.length;t++)r="<option ",n[t].Selected&&(r+=" selected "),r+=n[t].IsDefault?' data-isDefault="Y"':' data-isDefault="N" ',r+=" value="+n[t].Key+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>",b.append(r);b.trigger("change");i[0].style.visibility="hidden"}function ge(){vt.find(".VA003-infoRoot-leftDivContainer").css("display","inherit");var t=new n.OrgStructure.info(y.removeinfo);t.init();fu=t.getRoot();vt.prepend(fu)}function no(){var o=t('<div  class="VA003-infoRoot-leftDivContainer">'),s=t('<div  class="VA003-infoRoot-leftDiv">');t(ot.find(".VA003-left-tree")).append(o);var n=t("<div>"),i=t("<div>"),r=t("<div>"),u=t("<div>"),f=t("<div>"),e=t("<div>");n.append(t('<div class="VA003-Info-Icons" ><img class="VA003-infoRoot-icon" src="'+VIS.Application.contextUrl+'Areas/VA003/Images/orgstr-org1.png"><\/div>'));n.append(t('<div><div><span class="VA003-infoRoot-Header" >'+VIS.Msg.getMsg("VA003_SummaryNodes")+'<\/span><\/div><div><span class="VA003-infoRoot-infos">'+VIS.Msg.getMsg("VA003_SumaryInfo")+"<\/span><\/div><\/div>"));i.append(t('<div class="VA003-Info-Icons"><img src="'+VIS.Application.contextUrl+'Areas/VA003/Images/orgstr-legal-entity1.png"><\/div>'));i.append(t('<div><div><span class="VA003-infoRoot-Header" >'+VIS.Msg.getMsg("VA003_LegalNodes")+'<\/span><\/div><div><span class="VA003-infoRoot-infos">'+VIS.Msg.getMsg("VA003_LegalInfo")+"<\/span><\/div><\/div>"));r.append(t('<div class="VA003-Info-Icons"><img class="VA003-infoRoot-icon" src="'+VIS.Application.contextUrl+'Areas/VA003/Images/orgstr-store1.png"><\/div>'));r.append(t('<div><div><span class="VA003-infoRoot-Header" >'+VIS.Msg.getMsg("VA003_OrgUnitsNodes")+'<\/span><\/div><div><span class="VA003-infoRoot-infos">'+VIS.Msg.getMsg("VA003_NonLegalInfo")+"<\/span><\/div><\/div>"));u.append(t('<div class="VA003-Info-Icons"><img class="VA003-infoRoot-icon" src="'+VIS.Application.contextUrl+'Areas/VA003/Images/orgstr-edit.png"><\/div>'));u.append(t('<div><div><span class="VA003-infoRoot-Header" >'+VIS.Msg.getMsg("Edit")+'<\/span><\/div><div><span class="VA003-infoRoot-infos">'+VIS.Msg.getMsg("VA003_EditInfo")+"<\/span><\/div><\/div>"));f.append(t('<div class="VA003-Info-Icons"><img class="VA003-infoRoot-icon" src="'+VIS.Application.contextUrl+'Areas/VA003/Images/orgstr-folder-minus.png"><\/div>'));f.append(t('<div><div><span class="VA003-infoRoot-Header" >'+VIS.Msg.getMsg("VA003_ExpandTree")+'<\/span><\/div><div><span class="VA003-infoRoot-infos">'+VIS.Msg.getMsg("VA003_ExpandTreeInfo")+"<\/span><\/div><\/div>"));e.append(t('<div class="VA003-Info-Icons"><img class="VA003-infoRoot-icon" src="'+VIS.Application.contextUrl+'Areas/VA003/Images/orgstr-folder-add.png"><\/div>'));e.append(t('<div><div><span class="VA003-infoRoot-Header" >'+VIS.Msg.getMsg("VA003_CollapseTree")+'<\/span><\/div><div><span class="VA003-infoRoot-infos">'+VIS.Msg.getMsg("VA003_CollapseTreeInfo")+"<\/span><\/div><\/div>"));s.append(n).append(i).append(r).append(u).append(f).append(e);o.append(s)}function to(){var r=t('<div  class="VA003-infoRoot-leftDivContainer">'),i=t('<div  class="VA003-infoRoot-leftDiv">'),n;i.append(t('<div style="display: block; padding: 0 15px;"><div style=" width: 100%; float: left; "><span class="VA003-infoRoot-Header" >'+VIS.Msg.getMsg("VA003_OrgInfo")+'<\/span><\/div><div><span class="VA003-infoRoot-infos">'+VIS.Msg.getMsg("VA003_OrgnizationInfo")+"<\/span><\/div><\/div>"));n=t('<div style="float:left;width:100%">');n.append(t('<div class="VA003-Info-Icons"><img class="VA003-infoRoot-icon" src="'+VIS.Application.contextUrl+'Areas/VA003/Images/orgstr-toggle.png"><\/div>'));n.append(t('<div><div><span class="VA003-infoRoot-Header" >'+VIS.Msg.getMsg("VA003_EditUndo")+'<\/span><\/div><div><span class="VA003-infoRoot-infos">'+VIS.Msg.getMsg("VA003_EditUndoInfo")+"<\/span><\/div><\/div>"));i.append(n);ti.append(r);r.append(i)}function io(){var e=t('<div style="margin-top:65px" class="VA003-infoRoot-leftDivContainer">'),n=t('<div  class="VA003-infoRoot-leftDiv">');n.append(t('<div style="display: block; padding: 0 15px;"><div style=" width: 100%; float: left; "><span class="VA003-infoRoot-Header" >'+VIS.Msg.getMsg("VA003_ReportingHierarchy")+'<\/span><\/div><div><span class="VA003-infoRoot-infos">'+VIS.Msg.getMsg("VA003_HieraryInfo")+"<\/span><\/div><\/div>"));var i=t("<div>"),r=t("<div>"),u=t("<div>"),f=t("<div>");u.append(t('<div class="VA003-Info-Icons"><img class="VA003-infoRoot-icon" src="'+VIS.Application.contextUrl+'Areas/VA003/Images/orgstr-folder-minus.png"><\/div>'));u.append(t('<div><div><span class="VA003-infoRoot-Header" >'+VIS.Msg.getMsg("VA003_ExpandTree")+'<\/span><\/div><div><span class="VA003-infoRoot-infos">'+VIS.Msg.getMsg("VA003_ExpandTreeInfo")+"<\/span><\/div><\/div>"));f.append(t('<div class="VA003-Info-Icons"><img class="VA003-infoRoot-icon" src="'+VIS.Application.contextUrl+'Areas/VA003/Images/orgstr-folder-add.png"><\/div>'));f.append(t('<div><div><span class="VA003-infoRoot-Header" >'+VIS.Msg.getMsg("VA003_CollapseTree")+'<\/span><\/div><div><span class="VA003-infoRoot-infos">'+VIS.Msg.getMsg("VA003_CollapseTreeInfo")+"<\/span><\/div><\/div>"));i.append(t('<div class="VA003-Info-Icons"><img class="VA003-infoRoot-icon" src="'+VIS.Application.contextUrl+'Areas/VA003/Images/orgstr-addtree.png"><\/div>'));i.append(t('<div><div><span class="VA003-infoRoot-Header" >'+VIS.Msg.getMsg("VA003_AddTree")+'<\/span><\/div><div><span class="VA003-infoRoot-infos">'+VIS.Msg.getMsg("VA003_AddTreeInfo")+"<\/span><\/div><\/div>"));r.append(t('<div class="VA003-Info-Icons"><img class="VA003-infoRoot-icon" src="'+VIS.Application.contextUrl+'Areas/VA003/Images/orgstr-tree-node.png"><\/div>'));r.append(t('<div><div><span class="VA003-infoRoot-Header" >'+VIS.Msg.getMsg("VA003_AddNode")+'<\/span><\/div><div><span class="VA003-infoRoot-infos">'+VIS.Msg.getMsg("VA003_AddNodeinfo")+"<\/span><\/div><\/div>"));n.append(i).append(r).append(u).append(f);s.append(e);e.append(n)}var bu;this.frame=null;this.windowNo=null;var y=this,vr=VIS.Env.getCtx(),c=0,bt=0,d=0,tr="",ir=0,vt=t('<div class="VA003-content-wrap">'),ku=t("<div>"),du=t('<div style="width:200px:height:100%;overflow:auto">'),ot=t('<div class="VA003-leftMiddle-wrap">'),s=t('<div class="VA003-right-slide" data-isexpanded="Y">'),kt=null,ti=null,r=t("<div >"),ii=null,o=null,gu=null,tt=null,h=null,u=null,f=null,p=null,g=null,st=null,ht=null,ct=null,lt=null,w=null,at=null,l=null,hi=null,yr=null,b=t("<select>"),ri=null,nf=!1,a=null,v=null,nt=null,yt=null,pt=null,dt=null,pr=null,ci=null,gt=null,wr=null,br=null,yi=null,rr=null,ur=0,kr=0,dr=0,pi=0,gr=null,wi=null,tf=null,it=null,ui=null,rt=null,fi=null,ei=t('<button class="VA003-genrate-report"><i class="vis vis-cog"><\/i>'+VIS.Msg.getMsg("VA003_GenrateReportingHierarchy")+"<\/button>"),rf=t('<button class="VA003-refresh"><i class="vis vis-refresh"><\/i><\/button>'),ni=t('<button title="'+VIS.Msg.getMsg("VA003_ExpandTree")+'" class="VA003-expand"><\/button>'),fr=null,uf=t('<div class="vis-awindow-header vis-menuTitle">'),i,bi=null,ro={},li=!1,nu=!1,tu=!0,iu=[],ru=[],ft=!1,uo=0,fo=0,uu=null,fu=null,ki=!1,ai=null;this.initializeComponent=function(){ff();wf();ef();df();sf();of();i[0].style.visibility="visible";ee();eu();hf();no();to();io();cf()};bu=function(n){try{if(pi==0&&(pi=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"OrgStructure/ZoomToWindow",null)),pi>0){var t=new VIS.Query;t.addRestriction("AD_OrgType",VIS.Query.prototype.EQUAL,n);t.setRecordCount(1);VIS.viewManager.startWindow(pi,t)}i[0].style.visibility="hidden"}catch(r){i[0].style.visibility="hidden";console.log(r)}};this.addNodeToTree=function(n){cr(n)};this.removeinfo=function(){vt.find(".VA003-infoRoot-leftDivContainer").css("display","none");fu.remove()};this.formSizeChanged=function(n){var r,u,i,f,e;n&&ot.height(n);r=ot.outerHeight()-(kt.outerHeight()+ei.outerHeight()+25+42);ii.parent().height(r);u=ot.height()-(kt.height()+35+40);ti.height(u);i=s.find("#"+y.windowNo+"orgrighttree");i&&(f=t(s.find(".VA003-right-top")).height(),e=t(s.find(".VA003-form-data")).height(),i.height(s.height()-120))};this.getRoot=function(){return vt};this.disposeComponent=function(){s.off(VIS.Events.onTouchStartOrClick,".VA003-delete-link");s.off(VIS.Events.onTouchStartOrClick,".VA003-rename-link");a.off("click");v.off("click");nt.off("click");yt.off("click");pt.off("click");at.off("change");u.off("click");f.off("click");ei.off("click");b.off("change");dt.off("click");ci.off("click");r.data("kendoTreeView")!=undefined&&(r.data("kendoTreeView").destroy(),r.empty());o.data("kendoTreeView")!=undefined&&(o.data("kendoTreeView").destroy(),o.empty());y.windowNo=null;vr=null;c=0;bt=0;d=0;tr="";ir=0;tt.remove();h.remove();u.remove();f.remove();g.remove();st.remove();ht.remove();ct.remove();lt.remove();tt=null;h=null;u=null;f=null;g=null;st=null;ht=null;ct=null;lt=null;w=null;$cmbWarehouse=null;at.remove();l.remove();hi.remove();b.remove();ri.remove();at=null;l=null;hi=null;b=null;ri=null;a.remove();v.remove();nt.remove();yt.remove();pt.remove();dt.remove();ci.remove();kt.remove();a=null;v=null;nt=null;yt=null;pt=null;dt=null;ci=null;kt=null;ur=null;kr=null;dr=null;$btnAddChildNode=null;ei.remove();ei=null;i.remove();i=null;bi=null;ro=null;pi=null;ku.remove();du.remove();ot.remove();s.remove();ti.remove();r.remove();ii.remove();o.remove();ku=null;du=null;ot=null;s=null;kt=null;ti=null;r=null;ii=null;o=null;vt.remove();vt=null;y.frame=null;y=null};this.lockUI=function(){};this.unlockUI=function(){};this.sizeChanged=function(n,t){uo=n;fo=t;this.formSizeChanged(n,t)}}i.prototype.refresh=function(){this.formSizeChanged()};i.prototype.sizeChanged=function(n,t){this.sizeChanged(n,t)};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;t.setTitle("VA003_OrgStructure");t.hideHeader(!0);this.frame.getContentGrid().append(this.getRoot());this.initializeComponent()};i.prototype.dispose=function(){this.disposeComponent();this.frame=null};n.OrgStructure=i}(VA003,jQuery),function(n,t){n.OrgStructure.AddNode=function(n,i,r,u,f){function y(){h.append(t('<div class="VA003-form-data input-group vis-input-wrap">').append(t('<div class="vis-control-wrap">').append(v).append("<label>"+VIS.Msg.getMsg("SearchKey")+"<\/label>")));h.append(t('<div class="VA003-form-data input-group vis-input-wrap">').append(t('<div class="vis-control-wrap">').append(o).append("<label>"+VIS.Msg.getMsg("Name")+"<\/label>")));l=t('<button class="VIS_Pref_btn-2"  style="margin-top:0px;margin-bottom:0px;margin-right:10px;margin-left:10px;">'+VIS.Msg.getMsg("OK")+"<\/button>");a=t('<button class="VIS_Pref_btn-2"  style="margin-bottom:0px;margin-top:0px;">'+VIS.Msg.getMsg("Cancel")+"<\/button>");s.append(h).append(a).append(l);l.on("click",b);a.on("click",k)}function p(){$bsyDiv=t("<div>");$bsyDiv.css("position","absolute");$bsyDiv.css("bottom","0");$bsyDiv.css("background","url('"+VIS.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat");$bsyDiv.css("background-position","center center");$bsyDiv.css("width","97%");$bsyDiv.css("height","98%");$bsyDiv.css("text-align","center");$bsyDiv.css("z-index","1000");$bsyDiv[0].style.visibility="hidden";s.append($bsyDiv)}function w(){o.on("change",function(){o.val().length>0?o.removeClass("vis-ev-col-mandatory"):o.addClass("vis-ev-col-mandatory")})}function b(n){if(o.val().trim().length==0)return VIS.ADialog.info("EnterName"),n.preventDefault(),!1;$bsyDiv[0].style.visibility="visible";window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"OrgStructure/AddOrgNode",async:!1,data:{treeID:d,name:VIS.Utility.encodeText(o.val().trim()),description:"",value:VIS.Utility.encodeText(v.val().trim()),windowNo:g,parentID:r},success:function(t){var r=JSON.parse(t);if(r.ErrorMsg!=null&&r.ErrorMsg.length>0)return VIS.ADialog.error(r.ErrorMsg),$bsyDiv[0].style.visibility="hidden",n.preventDefault(),!1;i.addNodeToTree(r.Tree);$bsyDiv[0].style.visibility="hidden";e.close()},error:function(){$bsyDiv[0].style.visibility="hidden"}})},20)}function k(){e.close()}var d=n,g=i.windowNo,s=t('<div class="vis-formouterwrpdiv">'),h=t('<div style="width:100%" class="VA003-form-top-fields">'),e=null,c=this,l=null,a=null,v=t('<input maxlength="'+f+'" type="text" data-name="searchkey" placeholder=" " data-placeholder="">'),o=t('<input class="vis-ev-col-mandatory" maxlength="'+u+'"  type="text" data-name="name" placeholder=" " data-placeholder="">');p();this.show=function(){e=new VIS.ChildDialog;e.setContent(s);e.setWidth(340);e.setHeight(297);e.setTitle(VIS.Msg.getMsg("VA003_AddNode"));e.setModal(!0);e.onClose=function(){c.onClose&&c.onClose();c.dispose()};e.show();e.hideButtons();w();y()};this.dispose=function(){s.remove();s=null;h.remove();h=null;e=null;c=null}}}(VA003,jQuery),function(n,t){n.OrgStructure.info=function(n){function r(){i.append(t('<ul class="VA003-topRight-icons VA003-infoRoot-CloseInfo"><li><a style="float: initial;padding:0px"><span style="height:29px;width:29px" class="VA003-AddNode-infoCloseicon"><\/span><\/a><\/li><\/ul>'));t(i.find(".VA003-infoRoot-CloseInfo")).on("click",function(){n()})}var i=t('<div class="VA003-infoRoot">');this.init=function(){r()};this.getRoot=function(){return i}}}(VA003,jQuery)