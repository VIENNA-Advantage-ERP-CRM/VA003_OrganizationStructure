VA003 = window.VA003 || {}, function (n, t) { function i() { function ef() { sr = t('<a href="javascript:void(0)"  class="vis-mainMenuIcons vis-icon-menuclose"><\/a>'); var n = t("<p>" + VIS.Msg.getMsg("VA003_OrgStructure") + " <\/p>"); ct.append(cu.append(sr).append(n)); sr.click(function (n) { p.frame && p.frame.dispose(); p = null; n.stopPropagation() }) } function of() { ri = t('<div style="padding: 0px;border-right: white;" class="VA003-left-tree-wrap">'); ot.append(t('<div class="VA003-left-tree" style="padding: 0px;overflow:auto">').append(ri)).append(t('<div class="VA003-div-reportgeneratediv">').append(fi).append(kt).append(hu)); var n = ot.outerHeight() - (pt.outerHeight() + fi.outerHeight() + 130); ri.parent().height(n) } function sf() { r = t("<div>"); r.css("position", "absolute"); r.css("bottom", "0"); r.css("background", "url('" + VIS.Application.contextUrl + "Areas/VIS/Images/busy.gif') no-repeat"); r.css("background-position", "center center"); r.css("width", "98%"); r.css("height", "98%"); r.css("text-align", "center"); r.css("z-index", "1000"); r[0].style.visibility = "hidden"; ct.append(r) } function hf() { var n = t('<div style="width:100%;height:100%;float:left;  border-left: 4px solid #abbcc3;padding: 15px;padding-right:5px">'), i; s.append(n); i = t("<div>"); wr = t('<ul class="VA003-topRight-icons">'); er = t('<li><a  style="padding:0px" ><span style="height:31px;width:31px" class="VA003-Refresh-icon"><\/span><\/a><\/li>'); wt = t('<li><a  style="padding:0px" title="' + VIS.Msg.getMsg("VA003_AddNode") + '"><span style="height:31px;width:31px" class="VA003-AddNode-icon"><\/span><\/a><\/li>'); si = t('<li><a style="padding:0px" title="' + VIS.Msg.getMsg("VA003_AddTree") + '"><span style="height:31px;width:31px" class="VA003-AddTree-icon"><\/span><\/a><\/li>'); tr = t('<li ><a style="padding:0px" title="' + VIS.Msg.getMsg("VA003_ExpandTree") + '"><span style="height:31px;width:31px" class="VA003-Expand-icon"><\/span><\/a><\/li>'); wr.append(er).append(si).append(wt).append(tr); n.append(t('<div class="VA003-right-top">').append("<h4>" + VIS.Msg.getMsg("VA003_ReportingHierarchy") + "<\/h4>")); ct.append(s); eu = t('<div class="VA003-form-data-drp">'); n.append(eu.append(k)).append(i.append(wr)); u = t('<div style="float:left;width:100%" id="' + p.windowNo + 'orgrighttree">'); n.append(u); iu() } function cf() { vi = t('<ul  class="vis-apanel-rb-ul">'); vi.append('<li data-action="zoom" title=' + VIS.Msg.getMsg("Zoom") + ' style="opacity: 1"><img data-action="zoom" src="Areas/VIS/Images/Zoom16.png"><\/li>'); vi.append('<li data-action="refresh"  title=' + VIS.Msg.getMsg("Refresh") + ' ><img data-action="refresh" src="Areas/VIS/Images/Refresh16.png"><\/li>') } function lf() { v.on("click", function () { v.css("opacity") != "0.5" && (ur(), ce()) }); y.on("click", function () { y.css("opacity") != "0.5" && (ur(), le()) }); g.on("click", function () { g.css("opacity") != "0.5" && (ur(), ae()) }); yi.on("change", function () { vu() }); lt.on("click", ir); at.on("click", rr); oi.on("change", gu); fr.on("click", yf); o.on("click", ve); f.on("click", ye); fi.on("click", pe); k.on("change", nf); wt.on("click", ke); er.on("click", nf); si.on("click", ge); bt.on("click", de); hu.on("click", vu); or.on("click", no); kt.on("click", kf); tr.on("click", df); h.on("change", function () { h.val().length > 0 ? h.css("background-color", "white") : h.css("background-color", "#ffb6c1") }); gi.on("click", pf); w.on("change", af); vi.on(VIS.Events.onTouchStartOrClick, "LI", wf) } function af() { var u, n, r; w.prop("checked") ? (r = i.data("kendoTreeView").parent(i.data("kendoTreeView").select()), parent && t(r.find(".data-id")[0]).data("active") == !1 && (ht(!0), et = !1, VIS.ADialog.info("VA003_SetActive"), w.prop("checked", !1))) : (u = i.data("kendoTreeView").select(), n = i.data("kendoTreeView").select().find(".k-group").find(".data-id"), vf(n) || (ht(!0), et = !1, VIS.ADialog.info("VA003_SetInActive"), w.prop("checked", !0))) } function vf(n) { var r = !0, i; if (n != null && n.length > 0) for (i = 0; i < n.length; i++) if (t(n[i]).data("active")) { r = !1; break } return r } function yf() { var i = st[0].files[0], n = !1, t; if (i ? n = !0 : l.attr("src") && (n = !0), n) { if (!VIS.ADialog.ask("DeleteIt")) return; t = VIS.DB.executeQuery("UPDATE AD_OrgInfo SET Logo=null WHERE AD_ORg_ID=" + c); t > 0 && ki() } } function pf() { gi.w2overlay(vi.clone(!0)) } function wf(n) { var i = t(n.target).data("action"); r[0].style.visibility = "visible"; i == VIS.Actions.refresh ? t.ajax({ url: VIS.Application.contextUrl + "OrgStructure/RefreshOrgType", async: !0, success: function (n) { var i = JSON.parse(n), t; for (b.empty(), t = 0; t < i.length; t++) b.append("<option value=" + i[t].Key + ">" + i[t].Name + "<\/option>"); r[0].style.visibility = "hidden" }, error: function (n) { console.log(n); r[0].style.visibility = "hidden" } }) : i == VIS.Actions.zoom && lu(VIS.Utility.Util.getValueOfInt(b.val()), "Organization Type") } function bf() { var n, i; pt = t('<div class="VA003-top-buttons">'); n = t(' <ul class="VA003-topLeft-icons">'); y = t('<li><a title="' + VIS.Msg.getMsg("VA003_AddNode") + '" class="VA003-org-icon"><\/a><\/li>'); v = t('<li><a title="' + VIS.Msg.getMsg("VA003_AddLegalEntity") + '" class="VA003-entity-icon"><\/a><\/li>'); g = t(' <li><a title="' + VIS.Msg.getMsg("VA003_AddOrgUnit") + '" class="VA003-orgUnit-icon"><\/a><\/li>'); bt = t(' <li><a title="' + VIS.Msg.getMsg("Edit") + '" class="VA003-edit-icon"><\/a><\/li>'); lr = t('<li class="VA003-shworgchkwrp"><\/li>'); yi = t('<input type="checkbox" data-name="legal" >'); su = t("<li><label >" + VIS.Msg.getMsg("VA003_ShowOrgUnits") + "<\/label><\/li>"); lr.append(yi).append(su); or = $btnHdrSend = t('<img class="VA003-InfoIcon" title="' + VIS.Msg.getMsg("VA003_info").replace("&", "") + '" src="' + VIS.Application.contextUrl + 'Areas/VA003/Images/orgstr-info.png"> <\/img>'); cu.append(or); n.append(y).append(v).append(g).append(bt).append(lr); i = t('<ul class="VA003-topRight-icons">'); at = t('<li><a title="' + VIS.Msg.getMsg("VA003_Undo") + '"><span class="VA003-undo-icon"><\/span><\/a><\/li>'); lt = t('<li><a title="' + VIS.Msg.getMsg("VA003_Save") + '"><span class="VA003-save-icon"><\/span><\/a><\/li>'); i.append(at).append(lt); ht(!0); pt.append(n).append(i); ot.append(pt); ct.append(ot) } function au() { t.ajax({ url: VIS.Application.contextUrl + "OrgStructure/GetTree", async: !0, data: { windowNo: p.windowNo, showOrgUnits: yi.is(":checked") }, success: function (n) { ri.append(i); yr = []; yu(n) } }) } function vu() { au() } function kf() { kt.hasClass("VA003-expand") ? (kt.removeClass("VA003-expand"), kt.addClass("VA003-collapase"), i.data("kendoTreeView").expand(".k-item"), kt.prop("title", VIS.Msg.getMsg("VA003_CollapseTree"))) : (kt.removeClass("VA003-collapase"), kt.addClass("VA003-expand"), i.data("kendoTreeView").collapse(".k-item"), kt.prop("title", VIS.Msg.getMsg("VA003_ExpandTree"))) } function df() { var n = tr.find("span"); n.hasClass("VA003-Expand-icon") ? (n.removeClass("VA003-Expand-icon"), n.addClass("VA003-collapse-icon"), u.data("kendoTreeView").expand(".k-item"), n.prop("title", VIS.Msg.getMsg("VA003_CollapseTree"))) : (n.removeClass("VA003-collapse-icon"), n.addClass("VA003-Expand-icon"), u.data("kendoTreeView").collapse(".k-item"), n.prop("title", VIS.Msg.getMsg("VA003_ExpandTree"))) } function yu(n) { if (n == null || n == undefined) return null; var t = JSON.parse(n); ei = t[0].TableName; di = t[0].AD_Tree_ID; i.data("kendoTreeView") != undefined && (i.data("kendoTreeView").destroy(), i.empty()); i.kendoTreeView({ dataSource: t, dragAndDrop: !0, drop: ie, dragstart: te, select: ue, template: "<img src='" + VIS.Application.contextUrl + "#= item.ImageSource #' style='vertical-align: text-top;float: left;margin: 4px 0px 0px 10px;'><p style='min-width:122px;border-radius:4px;margin:0px;padding: 7px 10px 7px 38px; background-color:#= item.bColor #; color: #= item.color #'>#= item.text #<\/p><input type='hidden' class='data-id' value='#= item.NodeID #' data-active='#= item.IsActive #' data-summary='#= item.IsSummary #' data-orgparentid='#= item.OrgParentID #' data-parentid='#= item.ParentID #'   data-legal='#= item.IsLegal #'  data-Treeparentid='#= item.TreeParentID #' data-treeid='" + di + "' />" }); i.data("kendoTreeView").select(".k-first"); window.setTimeout(function () { i.find(".k-treeview").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); i.find(".k-in").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); i.find(".k-state-hover").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); i.find(".k-state-focused").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); i.find(".k-state-selected").css({ "border-color": "rgba(229, 228, 225, 1)", "background-color": "#DADADA", "-webkit-box-shadow": "rgba(229, 228, 225, 1)", padding: "4px" }); i.find(".k-state-selected").css({ "border-color": "rgba(229, 228, 225, 1)", "background-color": "#DADADA", "-webkit-box-shadow": "rgba(229, 228, 225, 1)", padding: "4px", "box-shadow": "transparent" }); i.find(".k-state-focused.k-state-selected").css({ "box-shadow": "none", "-webkit-box-shadow": "none" }) }, 100); p.sizeChanged(); nt(!0); bu(); dt(!1); r[0].style.visibility = "hidden" } function gf() { var u, n, v, i, c; ni = t('<div class="VA003-form-wrap">'); var e = t('<div style="width: 100%;float: left;overflow: auto;height: 100%;background-color:white">'), s = t('<div style="padding: 15px;padding-bottom:0px;" class="VA003-form-top">'), r = t('<div class="VA003-form-top-fields">'); e.append(s); ni.append(e.append(s.append(r))); ui = t('<label style="font-weight: bold;font-size: large;">' + VIS.Msg.getMsg("VA003_OrgInfo") + "<\/label>"); r.append(t('<div class="VA003-form-data"><\/div>').append(ui)); tt = t('<input type="text" data-name="searchkey">'); r.append(t(' <div class="VA003-form-data">').append("<label>" + VIS.Msg.getMsg("SearchKey") + "<\/label>").append(tt)); vt(tt); h = t('<input type="text" data-name="name">'); r.append(t(' <div class="VA003-form-data">').append("<label>" + VIS.Msg.getMsg("Name") + "<\/label>").append(h)); vt(h); u = t('<div class="VA003-image-wrap">'); l = t('  <img src="' + VIS.Application.contextUrl + 'Areas/VA003/Images/orgstr-org-logo.png" alt="Organization Logo">'); u.append(t('<span class="VA003-image-area">').append(l)); oi = t('<a style="margin-right:10px;cursor:pointer;float: left;width: 14px;height: 20px;overflow: hidden;display: block;cursor: pointer;"><span class="glyphicon glyphicon-pencil" style="cursor: pointer;"><input type="file" style="position: absolute; top: 0px; right: 0px; opacity: 0;cursor: pointer;"><\/span><\/a>'); fr = t('<a class="glyphicon glyphicon-remove" style="cursor:pointer"><\/a>'); st = oi.find("input"); u.append(t('<div class="VA003-image-upload">').append(t(' <div style=" position: absolute; float: right;   right: 3px;   bottom: -1px; "> <\/div>').append(oi).append(fr))); s.append(u); n = t('<div style="padding:15px" class="VA003-form-fullFields">'); e.append(n); v = new VIS.MLocationLookup(gt, p.windowNo); a = new VIS.Controls.VLocation("C_Location_ID", !1, !1, !0, VIS.DisplayType.Location, v); t(a.getControl()).data("name", "address"); n.append(t(' <div class="VA003-form-data">').append("<label>" + VIS.Msg.getMsg("Address") + "<\/label>").append(a.getControl().addClass("VA003-addressControl")).append(a.getBtn(0)).append(a.getBtn(1))); a.fireValueChanged = ne; gi = t('<button tabindex="-1" class="vis-controls-txtbtn-table-td2"><img tabindex="-1" src="' + VIS.Application.contextUrl + 'Areas/VIS/Images/base/Info20.png"><\/button>'); b = t('<select style="width:100%" data-name="orgtype">'); n.append(t(' <div class="VA003-form-data">').append("<label>" + VIS.Msg.getMsg("VA003_OrgType") + "<\/label>").append(t('<div class="VA003-orgtye-containerdiv">').append(b)).append(gi)); vt(b); it = t('<input type="text" data-name="taxid">'); n.append(t(' <div class="VA003-form-data">').append("<label>" + VIS.Msg.getMsg("VA003_TaxID") + "<\/label>").append(it)); vt(it); rt = t('<input type="text" data-name="phone">'); n.append(t(' <div class="VA003-form-data">').append("<label>" + VIS.Msg.getMsg("Phone") + "<\/label>").append(rt)); vt(rt); ut = t('<input type="text"  data-name="email">'); n.append(t(' <div class="VA003-form-data">').append("<label>" + VIS.Msg.getMsg("EMail") + "<\/label>").append(ut)); vt(ut); ft = t('<input type="text" data-name="fax">'); n.append(t(' <div class="VA003-form-data">').append("<label>" + VIS.Msg.getMsg("Fax") + "<\/label>").append(ft)); vt(ft); i = t(' <div class="VA003-form-data">'); o = t('<input type="checkbox" data-name="legal" style="width: auto;margin: 3px 10px 0 0;height: auto;">'); i.append(t(' <div style="width:50%"  class="VA003-form-data">').append(o).append('<label style="  width: auto;float: left;margin-bottom: 0;">' + VIS.Msg.getMsg("VA003_LegalEntity") + "<\/label>")); vt(o); f = t('<input type="checkbox" data-name="summary"  style="width: auto;margin: 3px 10px 0 0;height: auto;">'); i.append(t(' <div style="width:50%" class="VA003-form-data">').append(f).append('<label style="  width: auto;float: left;margin-bottom: 0;">' + VIS.Msg.getMsg("VA003_SummaryLevel") + "<\/label>")); vt(f); ti = t('<input type="checkbox" data-name="summary"  style="width: auto;margin: 3px 10px 0 0;height: auto;">'); pi = t(' <div style="width:50%" class="VA003-form-data">').append(ti).append('<label style="  width: auto;float: left;margin-bottom: 0;">' + VIS.Msg.translate(VIS.Env.getCtx(), "IsCostCenter") + "<\/label>"); i.append(pi); ii = t('<input type="checkbox" data-name="summary"  style="width: auto;margin: 3px 10px 0 0;height: auto;">'); wi = t(' <div style="width:50%" class="VA003-form-data">').append(ii).append('<label style="  width: auto;float: left;margin-bottom: 0;">' + VIS.Msg.translate(VIS.Env.getCtx(), "IsProfitCenter") + "<\/label>"); i.append(wi); n.append(i); c = t(' <div class="VA003-form-data">'); w = t('<input type="checkbox" data-name="Active"  style="width: auto;margin: 3px 10px 0 0;height: auto;">'); c.append(t(' <div style="width:50%" class="VA003-form-data">').append(w).append('<label style="  width: auto;float: left;margin-bottom: 0;">' + VIS.Msg.getMsg("VA003_Active") + "<\/label>")); vt(w); w.prop("checked", !0); n.append(c); ot.append(ni) } function li(n) { n ? ui.text(VIS.Msg.getMsg("VA003_AddOrg")) : ui.text(VIS.Msg.getMsg("VA003_OrgInfo")) } function ne() { et = !0; ht(!1) } function te(n) { if (et) { n.preventDefault(); window.setTimeout(function () { VIS.ADialog.ask("VA003_SaveExisting") ? ir() : rr() }, 200); et = !1; return } } function ie(n) { var y, c, f, s, u; if (!n.valid) { n.preventDefault(); return } if (n.dropPosition == "before") { n.preventDefault(); return } if (n.dropPosition == "after") { n.preventDefault(); return } var v = t(n.sourceNode).find(".data-id").data("summary"), b = t(n.destinationNode).find(".data-id").data("treeid"), d = t(n.sourceNode).find(".data-id").data("treeid"); if (d != b) { if (y = t(n.sourceNode).find(".data-id").data("active"), !y) return n.preventDefault(), !1; n.preventDefault(); t(n.destinationNode).find(".data-id").data("summary") && (re(this, n), k.trigger("change")); return } if (c = t(n.sourceNode).find(".data-id").data("legal"), t(n.destinationNode).find(".data-id").data("summary") != !0 && c == !0) { n.preventDefault(); return } if (f = t(n.destinationNode).find(".data-id").data("summary"), v && !f) { n.preventDefault(); return } var p = t(n.sourceNode).find(".data-id").data("treeid"), l = t(n.sourceNode).find(".data-id").val(), a = t(n.sourceNode).find(".data-id").data("treeparentid"), e = t.grep(yr, function (n) { return n.id == l }); if (e != undefined && e != null && e.length > 0 && (a = e[0].pid), s = t(n.destinationNode).find(".data-id").val(), f && (s = 0), u = 0, t(n.destinationNode).find(".data-id").data("summary") == !0 ? u = t(n.destinationNode).find(".data-id").val() : u == 0 && f && (u = t(n.destinationNode).find(".data-id").val()), a == u && f && t(n.destinationNode).find(".data-id").val() > 0) { n.preventDefault(); return } t(n.sourceNode).find(".data-id")[0].setAttribute("data-treeparentid", u); e != undefined && e != null && e.length > 0 ? e[0].pid = u : yr.push({ id: l, pid: u }); t(n.sourceNode).find(".data-id").data("orgparentid", s); f ? (s = 0, t(n.sourceNode).find(".data-id").data("parentid", parseInt(u))) : t(n.sourceNode).find(".data-id").data("parentid", 0); r[0].style.visibility = "visible"; var h = t(n.sourceNode).siblings(), g = t(n.destinationNode), o = t(n.destinationNode).children("ul").children(), w = t(n.sourceNode).find(".data-id").data("active"); o == null || o == "" || o.length == 0 ? window.setTimeout(function () { o = g.children("ul").children(); ku(h, a, o, u, p, f, l, s, !0); i.data("kendoTreeView").trigger("select", { node: t(n.sourceNode) }); pu(c, v, w, t(n.sourceNode)) }, 200) : window.setTimeout(function () { o = t(n.destinationNode).children("ul").children(); h.length == 1 && h.find(".data-id").val() == u && (h = []); ku(h, a, o, u, p, f, l, s, !0); i.data("kendoTreeView").trigger("select", { node: t(n.sourceNode) }); pu(c, v, w, t(n.sourceNode)) }, 200) } function pu(n, r, u, f) { var o = i.data("kendoTreeView").findByUid(f.data("uid")); i.data("kendoTreeView").select(o); n ? u ? (t(e.sourceNode).data("uid"), t(i.data("kendoTreeView").select().find("p")[0]).css("background-color", "#dc8a20")) : t(i.data("kendoTreeView").select().find("p")[0]).css("background-color", "#F4C993") : r ? u ? t(i.data("kendoTreeView").select().find("p")[0]).css("background-color", "#9c9c9c") : t(i.data("kendoTreeView").select().find("p")[0]).css("background-color", "#C0BEBE") : u ? t(i.data("kendoTreeView").select().find("p")[0]).css("background-color", "rgba(43, 174, 250, 0.78)") : t(i.data("kendoTreeView").select().find("p")[0]).css("background-color", "rgba(166, 222, 255, 1)") } function wu(n) { var u, f, l, s, i, e; if (!n.valid) { n.preventDefault(); return } if (n.dropPosition == "before" && t(n.destinationNode).find(".data-id").val() == 0) { n.preventDefault(); return } if (u = !1, n.dropPosition == "before" ? u = !0 : n.dropPosition == "after" && (u = !0), f = t(n.destinationNode).find(".data-id").data("summary"), !f && !u) { n.preventDefault(); return } if (l = t(n.sourceNode).find(".data-id").data("legal"), l && !f && !u) { n.preventDefault(); return } if (s = t(n.sourceNode).find(".data-id").data("summary"), s && !f) { n.preventDefault(); return } var v = t(n.sourceNode).find(".data-id").data("treeid"), h = t(n.sourceNode).find(".data-id").val(), o = t(n.sourceNode).find(".data-id").data("treeparentid"); if (o == 0 && s && (o = t(n.sourceNode).find(".data-id").val()), i = t.grep(pr, function (n) { return n.id == h }), i != undefined && i != null && i.length > 0 && (o = i[0].pid), e = 0, e = u ? t(n.destinationNode).find(".data-id").data("treeparentid") : t(n.destinationNode).find(".data-id").val(), o == e && !u) { n.preventDefault(); return } i != undefined && i != null && i.length > 0 ? i[0].pid = e : pr.push({ id: h, pid: e }); r[0].style.visibility = "visible"; var a = t(n.sourceNode).siblings(), y = t(n.destinationNode), c = t(n.destinationNode).children("ul").children(); window.setTimeout(function () { f && (c = t(n.destinationNode).children("ul").children()); u && (c = t(n.destinationNode).parent().children("li")); a = []; ee(a, o, c, e, v, f, h, null, !1) }, 200) } function re(n, i) { var a = n.dataItem(i.sourceNode).toJSON(), v = t(i.destinationNode), y = t(i.sourceNode).find(".data-id").val(), l = t(i.destinationNode).find(".data-id").val(), h = t(i.destinationNode).find(".data-id").data("treeid"), e = [], u = "", o = t(t(i.sourceNode).find(".data-id")[0]), f = 0, u = "SELECT  max(seqNo) FROM AD_TreeNode WHERE AD_Client_ID=" + gt.getAD_Client_ID() + " AND AD_Tree_ID=" + h, s, r, c; try { s = VIS.DB.executeReader(u, null, null); s.read() && (f = s.getString(0)) } catch (p) { } for (r = 0; r < o.length; r++) c = t(o[r]).data("active") == !0 ? "Y" : "N", u = "INSERT INTO AD_TreeNode (AD_Client_ID, AD_Org_ID, AD_Tree_ID, Created, CreatedBy, IsActive, Node_ID, Parent_ID, Updated, Updatedby,seqNo) VALUES(" + gt.getAD_Client_ID() + "," + gt.getAD_Org_ID() + "," + h + ",sysdate," + gt.getAD_User_ID() + ",'" + c + "'," + t(o[r]).val() + "," + l + ",sysdate," + gt.getAD_User_ID() + "," + (parseInt(f) + 10) + ") ", f = f + 10, e.push(u); console.log(e); VIS.DB.executeQueries(e) } function ue(n) { var o, u, e, s; if (et) if (VIS.ADialog.ask("VA003_SaveExisting")) { if (o = ir(), !o) { n.preventDefault(); return } } else rr(); ui.text(VIS.Msg.getMsg("VA003_OrgInfo")); u = t(n.node).find(".data-id"); e = u.val(); r[0].style.visibility = "visible"; e > 0 ? (fe(), nt(!1), se(e, !1), vr = !1, dt(!1)) : (bu(), nt(!0), vr = !0, ai(), kr(), dt(!1), r[0].style.visibility = "hidden"); s = u.data("orgparentid"); s > 0 && f.prop("disabled", !0); ci = u.data("summary"); (!ci || u.data("legal")) && (v.prop("disabled", !0), v.css("opacity", "0.5")); ci || u.data("legal") || (g.prop("disabled", !0), g.css("opacity", "0.5")); ci ? (y.prop("disabled", !1), y.css("opacity", "1")) : (y.prop("disabled", !0), y.css("opacity", "0.5")); ci ? (d = u.val(), yt = 0) : (d = u.data("treeparentid"), yt = u.val()); (d == "undefined" || d == null || d == undefined) && (d = 0); window.setTimeout(function () { i.find(".k-treeview").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); i.find(".k-in").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); i.find(".k-state-hover").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); i.find(".k-state-focused").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); i.find(".k-state-selected").css({ "border-color": "rgba(229, 228, 225, 1)", "background-color": "#DADADA", "-webkit-box-shadow": "rgba(229, 228, 225, 1)", padding: "4px" }); i.find(".k-state-selected").css({ "border-color": "rgba(229, 228, 225, 1)", "background-color": "#DADADA", "-webkit-box-shadow": "rgba(229, 228, 225, 1)", padding: "4px", "box-shadow": "transparent" }); i.find(".k-state-focused.k-state-selected").css({ "box-shadow": "none", "-webkit-box-shadow": "none" }) }, 100) } function bu() { v.prop("disabled", !1); v.css("opacity", "1"); g.prop("disabled", !1); g.css("opacity", "1"); h.attr("disabled", !0); tt.attr("disabled", !0); o.attr("disabled", !0); f.attr("disabled", !0); w.attr("disabled", !0); ai(); ki() } function fe() { v.prop("disabled", !1); v.css("opacity", "1"); g.prop("disabled", !1); g.css("opacity", "1"); h.attr("disabled", !1); tt.attr("disabled", !1); w.attr("disabled", !1); o.attr("disabled", !1); f.attr("disabled", !1) } function ku(n, i, u, f, e, o, s, h) { for (var a = [], l = "", v, c = 0; c < n.length; c++) l = "UPDATE ", l += ei + " SET Parent_ID=" + i + ", SeqNo=" + c + ", Updated=SysDate WHERE AD_Tree_ID=" + e + " AND Node_ID=" + t(n[c]).find(".data-id").val(), a.push(l); for (c = 0; c < u.length; c++) l = "UPDATE ", l += ei + " SET Parent_ID=" + f + ", SeqNo=" + c + ", Updated=SysDate WHERE AD_Tree_ID=" + e + " AND Node_ID=" + t(u[c]).find(".data-id").val(), a.push(l); v = f; o ? h = 0 : (l = " update AD_TreeNode set parent_id=0 WHERE AD_Tree_ID= " + e + " AND  Node_ID=" + s, a.push(l)); l = " update AD_OrgInfo set parent_org_id=" + h + " WHERE AD_Org_ID=" + s; a.push(l); console.log(a); VIS.DB.executeQueries(a); r[0].style.visibility = "hidden" } function ee(n, i, u, f, e) { for (var h = [], s = "", c, o = 0; o < n.length; o++) s = "UPDATE ", s += ei + " SET Parent_ID=" + i + ", SeqNo=" + o + ", Updated=SysDate WHERE AD_Tree_ID=" + e + " AND Node_ID=" + t(n[o]).find(".data-id").val(), h.push(s); for (o = 0; o < u.length; o++) s = "UPDATE ", s += ei + " SET Parent_ID=" + f + ", SeqNo=" + o + ", Updated=SysDate WHERE AD_Tree_ID=" + e + " AND Node_ID=" + t(u[o]).find(".data-id").val(), h.push(s); c = f; console.log(h); VIS.DB.executeQueries(h); r[0].style.visibility = "hidden" } function oe() { t.ajax({ url: VIS.Application.contextUrl + "OrgStructure/LoadLookups", success: function (n) { var t = JSON.parse(n); t && ou == !1 && (he(t.AllOrgType, t.AllReportHierarchy, t), ou = !0) } }) } function se(n, i) { t.ajax({ url: VIS.Application.contextUrl + "OrgStructure/GetOrgInfo", async: !0, data: { orgID: n, loadLookups: i }, success: function (n) { var t = JSON.parse(n); c = t.OrgID; yt = c; du(t, !0); r[0].style.visibility = "hidden" }, error: function (n) { VIS.ADialog.error("VA003_ErrorgettingOrg" + n); r[0].style.visibility = "hidden" } }) } function he(n, t, i) { if (n) for (var r = 0; r < n.length; r++) b.append("<option value=" + n[r].Key + ">" + n[r].Name + "<\/option>"); ru(t); h.attr("maxlength", i.NameLength); tt.attr("maxlength", i.ValueLength); ut.attr("maxlength", i.EMailLength); ft.attr("maxlength", i.FaxLength); rt.attr("maxlength", i.PhoneLength); it.attr("maxlength", i.TaxIDLength); nr = i.NameLength; hr = i.ValueLength; cr = i.TreeNameLength } function du(n, i) { f.attr("disabled", !1); ar || o.attr("disabled", !1); n == null || n == undefined ? (tt.val(""), h.val(""), it.val(""), ut.val(""), rt.val(""), ft.val(""), a.setValue(null), o.prop("checked", !1), b.val(-1), f.prop("checked", !1), nt(!1), ki(), dt(!0)) : (tt.val(n.SearchKey), h.val(n.Name), b.val(n.OrgType), it.val(n.TaxID), ut.val(n.EmailAddess), rt.val(n.Phone), ft.val(n.Fax), n.C_Location_ID == 0 ? a.setValue(null) : a.setValue(n.C_Location_ID), n.IsLegalEntity != null && n.IsLegalEntity != "" ? (o.prop("checked", n.IsLegalEntity), nt(!1)) : (o.prop("checked", !1), nt(!1)), n.IsSummary != null && n.IsSummary != "" ? (f.prop("checked", n.IsSummary), nt(!0)) : (f.prop("checked", !1), nt(!1)), n.ParentOrg > 0 ? (o.prop("disabled", !0), f.prop("disabled", !0), ar = !0) : (o.prop("disabled", !1), f.prop("disabled", !1), ar = !1), n.IsActive ? w.prop("checked", n.IsActive) : w.prop("checked", !1), n.OrgImage != null && n.OrgImage != undefined && n.OrgImage.length > 0 ? (l.show(), t(l.parent()).css("background-color", "white"), l.attr("src", VIS.Application.contextUrl + n.OrgImage)) : ki(), i && kr(n), dt(!1)) } function ki() { t(l.parent()).css("background-color", "#F4F4F4"); l.attr("src", null); l.hide() } function kr(n) { hi = n ? { Tenant: n.Tenant, SearchKey: n.SearchKey, Name: n.Name, TaxID: n.TaxID, EmailAddess: n.EmailAddess, Phone: n.Phone, Fax: n.Fax, C_Location_ID: n.C_Location_ID, IsSummary: n.IsSummary, IsLegalEntity: n.IsLegalEntity, OrgImage: n.OrgImage, IsActive: n.IsActive } : { Tenant: "", SearchKey: "", Name: "", TaxID: "", EmailAddess: "", Phone: "", Fax: "", C_Location_ID: "", IsSummary: "", IsLegalEntity: "", OrgImage: "", IsActive: "" } } function ce() { var n = dr(); n || (ht(!1), gr(), nu(v), ai(), dt(!0), li(!0), nt(!1), f.attr("disabled", !0), o.attr("disabled", !0), f.prop("checked", !1), o.prop("checked", !0), ti.prop("checked", !1), ii.prop("checked", !1), pi.hide(), wi.hide()) } function le() { var n = dr(); n || (ht(!1), nu(y), ai(), li(!0), gr(), nt(!0), dt(!0), f.attr("disabled", !0), o.attr("disabled", !0), f.prop("checked", !0), o.prop("checked", !1), ti.prop("checked", !1), ii.prop("checked", !1), pi.hide(), wi.hide()) } function dr() { return et ? (VIS.ADialog.ask("VA003_SaveExisting") ? ir() : rr(), et = !1, !0) : !1 } function ae() { var n = dr(); n || (ht(!1), gr(), nu(g), ai(), dt(!0), li(!0), nt(!1), f.attr("disabled", !0), o.attr("disabled", !0), f.prop("checked", !1), o.prop("checked", !1), ti.prop("checked", !1), ii.prop("checked", !1), pi.show(), wi.show()) } function gr() { h.attr("disabled", !1); tt.attr("disabled", !1) } function nu(n) { var t = { to: ni, className: "VA003-ui-effects-transfer" }; n.effect("transfer", t, 600, function () { }); st.val("") } function ai() { c = 0; tt.val(""); h.val(""); b.val(-1); ut.val(""); rt.val(""); ft.val(""); it.val(""); a.setValue(null); o.attr("checked", !1); f.attr("checked", !1); w.prop("checked", !0); ki() } function dt(n) { n ? h.css("background-color", "#ffb6c1") : vr || h.css("background-color", "white") } function nt(n) { b.attr("disabled", n); ut.attr("disabled", n); rt.attr("disabled", n); ft.attr("disabled", n); it.attr("disabled", n); a.getControl().attr("disabled", n); a.getBtn(0).attr("disabled", n); a.getBtn(1).attr("disabled", n); var t = "white"; n && (t = "#F4F4F4"); ut.css("background-color", t); rt.css("background-color", t); ft.css("background-color", t); it.css("background-color", t); b.css("background-color", t); a.getControl().css("background", t) } function vt(n) { if (n.is(":text")) n.on("keydown", function () { et = !0; ht(!1) }); else n.on("change", function () { et = !0; ht(!1) }) } function ir() { if (lt.css("opacity") != "0.5") { if (h.val().trim().length == 0) { VIS.ADialog.info("EnterName"); return } et = !1; d == c && (d = 0); r[0].style.visibility = "visible"; window.setTimeout(function () { var n = { OrgID: c, Tenant: gt.getAD_Client_ID(), SearchKey: VIS.Utility.encodeText(tt.val().trim()), Name: VIS.Utility.encodeText(h.val().trim()), C_Location_ID: a.getValue(), TaxID: VIS.Utility.encodeText(it.val().trim()), EmailAddess: VIS.Utility.encodeText(ut.val().trim()), Phone: VIS.Utility.encodeText(rt.val().trim()), Fax: VIS.Utility.encodeText(ft.val().trim()), OrgType: b.val(), IsActive: w.is(":checked"), IsSummary: f.is(":checked"), IsLegalEntity: o.is(":checked"), ParentIDForSummary: d, AD_Tree_ID: di, showOrgUnit: yi.is(":checked"), costCenter: ti.is(":checked"), profitCenter: ii.is(":checked") }; c != 0 || hi == null || hi.IsSummary || (n.ParentOrg = yt); t.ajax({ url: VIS.Application.contextUrl + "OrgStructure/InsertOrUpdateOrg", async: !0, data: n, success: function (u) { var e, s, b; if (u) { if (JSON.parse(u) == "VIS_OrgExist") { VIS.ADialog.warn("VA003_OrgExist"); r[0].style.visibility = "hidden"; return } if (JSON.parse(u).indexOf("Error") > -1) { VIS.ADialog.warn(JSON.parse(u)); r[0].style.visibility = "hidden"; return } if (e = w.is(":checked"), c == 0) { c = parseInt(JSON.parse(u)); s = {}; s.color = "white"; s.NodeID = c; s.text = VIS.Utility.encodeText(h.val()); s.IsSummary = !1; var l = f.is(":checked"), k = o.is(":checked"), a = "", p = "", g = i.data("kendoTreeView").select(); o.is(":checked") ? (a = e ? "#dc8a20" : "#F4C993", p = "Areas/VA003/Images/orgstr-legal-entity.PNG") : f.is(":checked") ? (a = e ? "#9c9c9c" : "#C0BEBE", p = "Areas/VA003/Images/orgstr-org.png") : (a = e ? "rgba(43, 174, 250, 0.78)" : "rgba(166, 222, 255, 1)", p = "Areas/VA003/Images/orgstr-store.PNG"); (!l || k) && (v.prop("disabled", !0), v.css("opacity", "0.5")); l ? (y.prop("disabled", !1), y.css("opacity", "1")) : (y.prop("disabled", !0), y.css("opacity", "0.5")); l ? (d = c, yt = 0) : (d = d, yt = c); b = i.data("kendoTreeView").append({ text: VIS.Utility.encodeText(h.val()), bColor: a, color: "white", NodeID: c, IsSummary: l, ImageSource: p, ParentID: yt, TreeParentID: d, OrgParentID: parseInt(yt), IsLegal: k, IsActive: e }, g); i.data("kendoTreeView").select(b); i.data("kendoTreeView").trigger("select", { node: b }); gu(); ii.prop("checked", !1); ti.prop("checked", !1); VIS.ADialog.info("Saved"); r[0].style.visibility = "hidden" } else bi ? (yu(u), ai(), nt(!0), r[0].style.visibility = "hidden") : (ii.prop("checked", !1), ti.prop("checked", !1), VIS.ADialog.info("Saved"), o.is(":checked") ? e ? t(i.data("kendoTreeView").select().find("p")[0]).css("background-color", "#dc8a20") : t(i.data("kendoTreeView").select().find("p")[0]).css("background-color", "#F4C993") : f.is(":checked") ? e ? t(i.data("kendoTreeView").select().find("p")[0]).css("background-color", "#9c9c9c") : t(i.data("kendoTreeView").select().find("p")[0]).css("background-color", "#C0BEBE") : e ? t(i.data("kendoTreeView").select().find("p")[0]).css("background-color", "rgba(43, 174, 250, 0.78)") : t(i.data("kendoTreeView").select().find("p")[0]).css("background-color", "rgba(166, 222, 255, 1)"), e ? t(t(i.data("kendoTreeView").select()).find(".data-id")[0]).data("active", !0) : t(t(i.data("kendoTreeView").select()).find(".data-id")[0]).data("active", !1), r[0].style.visibility = "hidden"); bi = !1; kr(n); ht(!0) } li(!1) }, error: function (n) { VIS.ADialog.error("VA003_ErrorInSaving" + n); li(!1) } }) }, 200) } } function rr() { at.css("opacity") != "0.5" && (et = !1, du(hi, !1), ht(!0), li(!1), dt(!1)) } function ht(n) { at.prop("disabled", n); lt.prop("disabled", n); n ? (at.css("opacity", ".5"), lt.css("opacity", ".5")) : (at.css("opacity", "1"), lt.css("opacity", "1")) } function gu() { var i, u, n, f; if (c > 0) { if (n = st[0].files[0], n != null && n != undefined) { if (n.size > 51200) { st.val(""); VIS.ADialog.info("VA003_picSize"); return } r[0].style.visibility = "visible"; i = new XMLHttpRequest; u = new FormData; u.append("pic", n); u.append("orgID", c); i.open("POST", VIS.Application.contextUrl + "OrgStructure/UploadPic"); i.send(u); i.addEventListener("load", function (n) { var i = n.target.response, u = JSON.parse(i), f = JSON.parse(u); l.show(); t(l.parent()).css("background-color", "white"); l.attr("src", VIS.Application.contextUrl + f); r[0].style.visibility = "hidden" }) } st.val("") } else if (n = st[0].files[0], n) { if (n.size > 51200) { st.val(""); VIS.ADialog.info("VA003_picSize"); return } f = new FileReader; f.onloadend = function () { l.show(); t(l.parent()).css("background-color", "white"); l.attr("src", f.result) }; f.readAsDataURL(n) } } function ve() { c > 0 && (f.is(":checked") && f.attr("checked", !1), bi = !0); nt(o.is(":checked")) } function ye(n) { if (c > 0) if (o.is(":checked")) { if (!VIS.ADialog.ask("VA003_changeToSummary")) { n.preventDefault(); return } o.attr("checked", !1); bi = !0 } else if (!ci && f.is(":checked")) { if (!VIS.ADialog.ask("VA003_changeToSummary")) { n.preventDefault(); return } o.attr("checked", !1); bi = !0 } nt(f.is(":checked")) } function pe() { r[0].style.visibility = "visible"; window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "OrgStructure/GenerateHeirarchy", async: !0, data: { windowNo: p.windowNo }, success: function (n) { var t = JSON.parse(n), i, u; if (t != null) { if (t == "ProcessFailed") { VIS.ADialog.error("ProcessFailed"); r[0].style.visibility = "hidden"; return } if (t == "ProcessNoInstance") { VIS.ADialog.error("ProcessNoInstance"); r[0].style.visibility = "hidden"; return } if (jQuery.type(t) == "string" && t.indexOf("Error") > -1) { VIS.ADialog.error(t); r[0].style.visibility = "hidden"; return } i = t.AllReportHierarchy; ru(i); u = t.Tree; tu(u) } }, error: function (n) { console.log(n); VIS.ADialog.error("VA003_ControllerNotFound"); r[0].style.visibility = "hidden" } }) }, 200) } function nf() { pr = []; var n = k.val(); if (n < 0) { u.data("kendoTreeView") != undefined && (u.data("kendoTreeView").destroy(), u.empty()); return } k.find("option:selected").data("isdefault") == "Y" ? wt.css("opacity", "0.5") : wt.css("opacity", "1"); r[0].style.visibility = "visible"; t.ajax({ url: VIS.Application.contextUrl + "OrgStructure/CreateTree", data: { windowNo: p.windowNo, treeID: n }, success: function (n) { treeData = JSON.parse(n); tu(treeData); k.find("option:selected").data("isdefault") == "N" && u.data("kendoTreeView").expand(".k-item") }, error: function () { VIS.ADialog.error("VA003_ControllerNotFound"); r[0].style.visibility = "hidden" } }) } function tu(n) { var i, f, e, o; u.data("kendoTreeView") != undefined && (u.data("kendoTreeView").destroy(), u.empty()); i = k.find("option:selected").data("isdefault") == "Y" ? !1 : !0; f = n[0].AD_Tree_ID; i ? u.kendoTreeView({ dataSource: n, dragAndDrop: i, drop: wu, select: tf, template: "<div style='float: left;border-radius: 4px; background: #= item.bColor #;'><img src='" + VIS.Application.contextUrl + "#= item.ImageSource #' style='vertical-align: text-top;float: left;margin: 4px 0px 0px 10px; '><p style='float: left;min-width:122px;border-radius:4px;margin:0px;padding: 7px 10px 7px 10px;  color: #= item.color #'>#= item.text #<\/p><input type='hidden' class='data-id' value='#= item.NodeID #'  data-legal='#= item.IsLegal #'  data-summary='#= item.IsSummary #'  data-parentid='#= item.ParentID #'  data-Treeparentid='#= item.TreeParentID #'   data-treeid='" + f + "' /><\/div><div style='float:left'><a style='cursor:pointer;float:left;display:#= item.DeleteVisibility #' title='" + VIS.Msg.getMsg("Delete") + "' class='VA003-delete-link' ><\/a><a style='cursor:pointer;float:left;display:#= item.Visibility #' title='" + VIS.Msg.getMsg("VA003_Rename") + "'  class='VA003-rename-link' ><\/a><\/div>" }) : u.kendoTreeView({ dataSource: n, dragAndDrop: i, drop: wu, select: tf, template: "<div style='float: left;border-radius: 4px; background: #= item.bColor #;'><img src='" + VIS.Application.contextUrl + "#= item.ImageSource #' style='vertical-align: text-top;float: left;margin: 4px 0px 0px 10px; '><p style='float: left;min-width:122px;border-radius:4px;margin:0px;padding: 7px 10px 7px 10px;  color: #= item.color #'>#= item.text #<\/p><input type='hidden' class='data-id' value='#= item.NodeID #'  data-legal='#= item.IsLegal #'  data-summary='#= item.IsSummary #'  data-parentid='#= item.ParentID #'  data-Treeparentid='#= item.TreeParentID #'   data-treeid='" + f + "' /><\/div><div style='float:left;display:#= item.Visibility #'><a style='cursor:pointer;float:left' title='" + VIS.Msg.getMsg("VA003_Rename") + "'  class='VA003-rename-link' ><\/a><\/div>" }); u && (e = t(s.find(".VA003-right-top")).outerHeight(), o = t(s.find(".VA003-form-data")).outerHeight(), u.height(s.outerHeight() - 120)); window.setTimeout(function () { u.find(".k-treeview").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); u.find(".k-in").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); u.find(".k-state-hover").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); u.find(".k-state-focused").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); u.find(".k-state-selected").css({ "border-color": "rgba(229, 228, 225, 1)", "background-color": "#DADADA", "-webkit-box-shadow": "rgba(229, 228, 225, 1)", padding: "4px" }); u.find(".k-state-selected").css({ "border-color": "rgba(229, 228, 225, 1)", "background-color": "#DADADA", "-webkit-box-shadow": "rgba(229, 228, 225, 1)", padding: "4px", "box-shadow": "transparent" }); u.find(".k-state-focused.k-state-selected").css({ "box-shadow": "none", "-webkit-box-shadow": "none" }) }, 100); s.off(VIS.Events.onTouchStartOrClick, ".VA003-delete-link"); s.on(VIS.Events.onTouchStartOrClick, ".VA003-delete-link", be); s.off(VIS.Events.onTouchStartOrClick, ".VA003-rename-link"); s.on(VIS.Events.onTouchStartOrClick, ".VA003-rename-link", we); r[0].style.visibility = "hidden" } function tf() { window.setTimeout(function () { u.find(".k-treeview").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); u.find(".k-in").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); u.find(".k-state-hover").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); u.find(".k-state-focused").css({ "border-color": "transparent", "background-color": "transparent", "-webkit-box-shadow": "none" }); u.find(".k-state-selected").css({ "border-color": "rgba(229, 228, 225, 1)", "background-color": "#DADADA", "-webkit-box-shadow": "rgba(229, 228, 225, 1)", padding: "4px" }); u.find(".k-state-selected").css({ "border-color": "rgba(229, 228, 225, 1)", "background-color": "#DADADA", "-webkit-box-shadow": "rgba(229, 228, 225, 1)", padding: "4px", "box-shadow": "transparent" }); u.find(".k-state-focused.k-state-selected").css({ "box-shadow": "none", "-webkit-box-shadow": "none" }) }, 100) } function we() { var s = t(t(this).closest(".k-item")).find(".data-id").val(), f = u.data("kendoTreeView"), h = f.dataItem(f.select()).text, e = t("<div>"), o = t('<div style="width:100%" class="VA003-form-top-fields">'), i = t('<input  maxlength="' + nr + '" type="text" data-name="name">'), n; i.val(h); i.select(); o.append(t('<div class="VA003-form-data"><\/div>').append("<label>" + VIS.Msg.getMsg("Name") + "<\/label>").append(i)); e.append(o); n = new VIS.ChildDialog; n.setContent(e); n.setWidth("350px"); n.setTitle(VIS.Msg.getMsg("VA003_RenameNode")); n.setModal(!0); n.onClose = function () { }; n.show(); n.onOkClick = function () { var n, t, f; if (i.val().trim().length == 0) { VIS.ADialog.info("EnterName"); return } r[0].style.visibility = "visible"; n = []; t = ""; t = "UPDATE AD_Org SET name='" + VIS.Utility.encodeText(i.val()) + "' WHERE AD_Org_ID=" + s; n.push(t); console.log(n); VIS.DB.executeQueries(n, null, function (n) { console.log(n) }); f = u.data("kendoTreeView"); f.dataItem(f.select()).set("text", VIS.Utility.encodeText(i.val())); r[0].style.visibility = "hidden" }; n.onCancelClick = function () { } } function be() { var f; if (VIS.ADialog.ask("DeleteIt")) { r[0].style.visibility = "visible"; f = u.data("kendoTreeView"); f.remove(t(this).closest(".k-item")); var e = t(t(this).closest(".k-item")).find(".data-id").val(), o = t(t(this).closest(".k-item")).find(".data-id").data("treeid"), n = [], i = ""; i = "DELETE FROM AD_TreeNode WHERE AD_Tree_ID=" + o + " AND parent_ID=" + e; n.push(i); i = "DELETE FROM AD_TreeNode WHERE AD_Tree_ID=" + o + " AND Node_ID=" + e; n.push(i); console.log(n); VIS.DB.executeQueries(n, null, function (n) { console.log(n) }); r[0].style.visibility = "hidden" } } function ke() { if (wt.css("opacity") != "0.5") { var t = u.data("kendoTreeView").select().find(".data-id").val(), i = new n.OrgStructure.AddNode(k.val(), p, t, nr, hr); i.show() } } function de() { s.data("isexpanded") == "N" ? (s.data("isexpanded", "Y"), s.animate({ width: "67%" }, 800, function () { bt.find("img").attr("src", VIS.Application.contextUrl + "Areas/VA003/Images/orgstr-toggle.png"); iu() }), bt.find("a").removeClass("VA003-toggle-icon"), bt.find("a").addClass("VA003-edit-icon")) : ur() } function ur() { s.data("isexpanded") == "Y" && (s.data("isexpanded", "N"), s.animate({ width: "35%" }, 800, function () { bt.find("img").attr("src", VIS.Application.contextUrl + "Areas/VA003/Images/arrow-left.png"); iu() }), bt.find("a").addClass("VA003-toggle-icon"), bt.find("a").removeClass("VA003-edit-icon")) } function iu() { } function ge() { var u = t("<div>"), f = t('<div style="width:100%" class="VA003-form-top-fields">'), i = t('<input maxlength="' + cr + '" type="text" data-name="name">'), n; f.append(t('<div class="VA003-form-data"><\/div>').append("<label>" + VIS.Msg.getMsg("Name") + "<\/label>").append(i)); u.append(f); n = new VIS.ChildDialog; n.setContent(u); n.setWidth("350px"); n.setTitle(VIS.Msg.getMsg("VA003_AddTree")); n.setModal(!0); n.onClose = function () { }; n.show(); n.onOkClick = function (n) { if (i.val().trim().length == 0) return VIS.ADialog.info("EnterName"), n.preventDefault(), !1; r[0].style.visibility = "visible"; t.ajax({ url: VIS.Application.contextUrl + "OrgStructure/AddNewTree", async: !0, data: { name: VIS.Utility.encodeText(i.val().trim()) }, success: function (n) { var t, i; if (n == null || n == undefined) return r[0].style.visibility = "hidden", null; t = JSON.parse(n); k.empty(); i = t.AllReportHierarchy; ru(i) } }) }; n.onCancelClick = function () { } } function ru(n) { var t, i; if (k.empty(), n) for (t = 0; t < n.length; t++) i = "<option ", n[t].Selected && (i += " selected "), i += n[t].IsDefault ? ' data-isDefault="Y"' : ' data-isDefault="N" ', i += " value=" + n[t].Key + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>", k.append(i); k.trigger("change"); r[0].style.visibility = "hidden" } function no() { ct.find(".VA003-infoRoot-leftDivContainer").css("display", "inherit"); var t = new n.OrgStructure.info(p.removeinfo); t.init(); br = t.getRoot(); ct.prepend(br) } function to() { var o = t('<div  class="VA003-infoRoot-leftDivContainer">'), s = t('<div  class="VA003-infoRoot-leftDiv">'); t(ot.find(".VA003-left-tree")).append(o); var n = t('<div style="overflow:auto">'), i = t('<div style="overflow:auto">'), r = t('<div style="overflow:auto">'), u = t('<div style="overflow:auto">'), f = t('<div style="overflow:auto">'), e = t('<div style="overflow:auto">'); n.append(t('<div class="VA003-Info-Icons" ><img  style="background-color:#9c9c9c" class="VA003-infoRoot-icon" src="' + VIS.Application.contextUrl + 'Areas/VA003/Images/orgstr-org1.png"><\/div>')); n.append(t('<div style="overflow-y;margin-bottom:5px"><div style="overflow:auto"><span class="VA003-infoRoot-Header" >' + VIS.Msg.getMsg("VA003_SummaryNodes") + '<\/span><\/div><div style="overflow:auto"><span class="VA003-infoRoot-infos">' + VIS.Msg.getMsg("VA003_SumaryInfo") + "<\/span><\/div><\/div>")); i.append(t('<div class="VA003-Info-Icons"><img  style="background-color:#dc8a20"  class="VA003-infoRoot-icon" src="' + VIS.Application.contextUrl + 'Areas/VA003/Images/orgstr-legal-entity1.png"><\/div>')); i.append(t('<div style="overflow-y;margin-bottom:5px"><div style="overflow:auto"><span class="VA003-infoRoot-Header" >' + VIS.Msg.getMsg("VA003_LegalNodes") + '<\/span><\/div><div style="overflow:auto"><span class="VA003-infoRoot-infos">' + VIS.Msg.getMsg("VA003_LegalInfo") + "<\/span><\/div><\/div>")); r.append(t('<div class="VA003-Info-Icons"><img  style="background-color:rgba(43, 174, 250, 0.78)"  class="VA003-infoRoot-icon" src="' + VIS.Application.contextUrl + 'Areas/VA003/Images/orgstr-store1.png"><\/div>')); r.append(t('<div style="overflow-y;margin-bottom:5px"><div style="overflow:auto"><span class="VA003-infoRoot-Header" >' + VIS.Msg.getMsg("VA003_OrgUnitsNodes") + '<\/span><\/div><div style="overflow:auto"><span class="VA003-infoRoot-infos">' + VIS.Msg.getMsg("VA003_NonLegalInfo") + "<\/span><\/div><\/div>")); u.append(t('<div class="VA003-Info-Icons"><img    style="background-color:rgba(43, 174, 250, 0.78)"  class="VA003-infoRoot-icon" src="' + VIS.Application.contextUrl + 'Areas/VA003/Images/orgstr-edit.png"><\/div>')); u.append(t('<div style="overflow-y;margin-bottom:5px"><div style="overflow:auto"><span class="VA003-infoRoot-Header" >' + VIS.Msg.getMsg("Edit") + '<\/span><\/div><div style="overflow:auto"><span class="VA003-infoRoot-infos">' + VIS.Msg.getMsg("VA003_EditInfo") + "<\/span><\/div><\/div>")); f.append(t('<div class="VA003-Info-Icons"><img    style="background-color:rgba(43, 174, 250, 0.78)"  class="VA003-infoRoot-icon" src="' + VIS.Application.contextUrl + 'Areas/VA003/Images/orgstr-folder-minus.png"><\/div>')); f.append(t('<div style="overflow-y;margin-bottom:5px"><div style="overflow:auto"><span class="VA003-infoRoot-Header" >' + VIS.Msg.getMsg("VA003_ExpandTree") + '<\/span><\/div><div style="overflow:auto"><span class="VA003-infoRoot-infos">' + VIS.Msg.getMsg("VA003_ExpandTreeInfo") + "<\/span><\/div><\/div>")); e.append(t('<div class="VA003-Info-Icons"><img    style="background-color:rgba(43, 174, 250, 0.78)"  class="VA003-infoRoot-icon" src="' + VIS.Application.contextUrl + 'Areas/VA003/Images/orgstr-folder-add.png"><\/div>')); e.append(t('<div style="overflow-y;margin-bottom:5px"><div style="overflow:auto"><span class="VA003-infoRoot-Header" >' + VIS.Msg.getMsg("VA003_CollapseTree") + '<\/span><\/div><div style="overflow:auto"><span class="VA003-infoRoot-infos">' + VIS.Msg.getMsg("VA003_CollapseTreeInfo") + "<\/span><\/div><\/div>")); s.append(n).append(i).append(r).append(u).append(f).append(e); o.append(s) } function io() { var r = t('<div  class="VA003-infoRoot-leftDivContainer">'), i = t('<div  class="VA003-infoRoot-leftDiv">'), n; i.append(t('<div style="margin: 10px;margin-top: 0px;"><div style="overflow:auto"><span class="VA003-infoRoot-Header" >' + VIS.Msg.getMsg("VA003_OrgInfo") + '<\/span><\/div><div style="overflow:auto"><span class="VA003-infoRoot-infos">' + VIS.Msg.getMsg("VA003_OrgnizationInfo") + "<\/span><\/div><\/div>")); n = t('<div style="overflow:auto;float:left;width:100%">'); n.append(t('<div class="VA003-Info-Icons"><img    style="background-color:rgba(43, 174, 250, 0.78)"  class="VA003-infoRoot-icon" src="' + VIS.Application.contextUrl + 'Areas/VA003/Images/orgstr-toggle.png"><\/div>')); n.append(t('<div style="overflow-y;margin-bottom:5px"><div style="overflow:auto"><span class="VA003-infoRoot-Header" >' + VIS.Msg.getMsg("VA003_EditUndo") + '<\/span><\/div><div style="overflow:auto"><span class="VA003-infoRoot-infos">' + VIS.Msg.getMsg("VA003_EditUndoInfo") + "<\/span><\/div><\/div>")); i.append(n); ni.append(r); r.append(i) } function ro() { var e = t('<div style="margin-top:65px" class="VA003-infoRoot-leftDivContainer">'), n = t('<div  class="VA003-infoRoot-leftDiv">'); n.append(t('<div style="margin: 10px;margin-top: 0px;"><div style="overflow:auto"><span class="VA003-infoRoot-Header" >' + VIS.Msg.getMsg("VA003_ReportingHierarchy") + '<\/span><\/div><div style="overflow:auto"><span class="VA003-infoRoot-infos">' + VIS.Msg.getMsg("VA003_HieraryInfo") + "<\/span><\/div><\/div>")); var i = t('<div style="overflow:auto;float:left;width:100%">'), r = t('<div style="overflow:auto;float:left;width:100%">'), u = t('<div style="overflow:auto;float:left;width:100%">'), f = t('<div style="overflow:auto;float:left;width:100%">'); u.append(t('<div class="VA003-Info-Icons"><img    style="background-color:#616364"  class="VA003-infoRoot-icon" src="' + VIS.Application.contextUrl + 'Areas/VA003/Images/orgstr-folder-minus.png"><\/div>')); u.append(t('<div style="overflow-y;margin-bottom:5px"><div style="overflow:auto"><span class="VA003-infoRoot-Header" >' + VIS.Msg.getMsg("VA003_ExpandTree") + '<\/span><\/div><div style="overflow:auto"><span class="VA003-infoRoot-infos">' + VIS.Msg.getMsg("VA003_ExpandTreeInfo") + "<\/span><\/div><\/div>")); f.append(t('<div class="VA003-Info-Icons"><img    style="background-color:#616364"  class="VA003-infoRoot-icon" src="' + VIS.Application.contextUrl + 'Areas/VA003/Images/orgstr-folder-add.png"><\/div>')); f.append(t('<div style="overflow-y;margin-bottom:5px"><div style="overflow:auto"><span class="VA003-infoRoot-Header" >' + VIS.Msg.getMsg("VA003_CollapseTree") + '<\/span><\/div><div style="overflow:auto"><span class="VA003-infoRoot-infos">' + VIS.Msg.getMsg("VA003_CollapseTreeInfo") + "<\/span><\/div><\/div>")); i.append(t('<div class="VA003-Info-Icons"><img    style="background-color:#616364"  class="VA003-infoRoot-icon" src="' + VIS.Application.contextUrl + 'Areas/VA003/Images/orgstr-addtree.png"><\/div>')); i.append(t('<div style="overflow-y;margin-bottom:5px"><div style="overflow:auto"><span class="VA003-infoRoot-Header" >' + VIS.Msg.getMsg("VA003_AddTree") + '<\/span><\/div><div style="overflow:auto"><span class="VA003-infoRoot-infos">' + VIS.Msg.getMsg("VA003_AddTreeInfo") + "<\/span><\/div><\/div>")); r.append(t('<div class="VA003-Info-Icons"><img    style="background-color:#616364"  class="VA003-infoRoot-icon" src="' + VIS.Application.contextUrl + 'Areas/VA003/Images/orgstr-tree-node.png"><\/div>')); r.append(t('<div style="overflow-y;margin-bottom:5px"><div style="overflow:auto"><span class="VA003-infoRoot-Header" >' + VIS.Msg.getMsg("VA003_AddNode") + '<\/span><\/div><div style="overflow:auto"><span class="VA003-infoRoot-infos">' + VIS.Msg.getMsg("VA003_AddNodeinfo") + "<\/span><\/div><\/div>")); n.append(i).append(r).append(u).append(f); s.append(e); e.append(n) } var lu; this.frame = null; this.windowNo = null; var p = this, gt = VIS.Env.getCtx(), c = 0, yt = 0, d = 0, ei = "", di = 0, ct = t('<div class="VA003-content-wrap">'), uu = t("<div>"), fu = t('<div style="width:200px:height:100%;overflow:auto">'), ot = t('<div class="VA003-leftMiddle-wrap">'), s = t('<div class="VA003-right-slide" data-isexpanded="Y">'), pt = null, ni = null, i = t("<div >"), ri = null, u = null, eu = null, tt = null, h = null, o = null, f = null, w = null, b = null, it = null, rt = null, ut = null, ft = null, a = null, st = null, l = null, oi = null, fr = null, k = t("<select>"), ui = null, ou = !1, v = null, y = null, g = null, lt = null, at = null, wt = null, er = null, si = null, bt = null, or = null, sr = null, vi = null, gi = null, nr = 0, hr = 0, cr = 0, lr = null, yi = null, su = null, ti = null, pi = null, ii = null, wi = null, fi = t('<button class="VA003-genrate-report">' + VIS.Msg.getMsg("VA003_GenrateReportingHierarchy") + "<\/button>"), hu = t('<button class="VA003-refresh"><\/button>'), kt = t('<button title="' + VIS.Msg.getMsg("VA003_ExpandTree") + '" class="VA003-expand"><\/button>'), tr = null, cu = t('<div class="vis-awindow-header vis-menuTitle">'), r, hi = null, rf = {}, ci = !1, ar = !1, vr = !0, yr = [], pr = [], et = !1, uf = 0, ff = 0, wr = null, br = null, bi = !1; this.initializeComponent = function () { ef(); bf(); of(); gf(); hf(); sf(); r[0].style.visibility = "visible"; oe(); au(); cf(); to(); io(); ro(); lf() }; lu = function (n, t) { var e = "select ad_window_id from ad_window where name = '" + t + "'", f = 0, i, u; try { i = VIS.DB.executeDataReader(e); i.read() && (f = i.getInt(0)); i.dispose(); f > 0 && (u = new VIS.Query, u.addRestriction("AD_OrgType", VIS.Query.prototype.EQUAL, n), u.setRecordCount(1), VIS.viewManager.startWindow(f, u)); r[0].style.visibility = "hidden" } catch (o) { r[0].style.visibility = "hidden"; console.log(o) } }; this.addNodeToTree = function (n) { tu(n) }; this.removeinfo = function () { ct.find(".VA003-infoRoot-leftDivContainer").css("display", "none"); br.remove() }; this.formSizeChanged = function (n) { var r, u, i, f, e; n && ot.height(n); r = ot.outerHeight() - (pt.outerHeight() + fi.outerHeight() + 25 + 42); ri.parent().height(r); u = ot.height() - (pt.height() + 35 + 40); ni.height(u); i = s.find("#" + p.windowNo + "orgrighttree"); i && (f = t(s.find(".VA003-right-top")).height(), e = t(s.find(".VA003-form-data")).height(), i.height(s.height() - 120)) }; this.getRoot = function () { return ct }; this.disposeComponent = function () { s.off(VIS.Events.onTouchStartOrClick, ".VA003-delete-link"); s.off(VIS.Events.onTouchStartOrClick, ".VA003-rename-link"); v.off("click"); y.off("click"); g.off("click"); lt.off("click"); at.off("click"); st.off("change"); o.off("click"); f.off("click"); fi.off("click"); k.off("change"); wt.off("click"); si.off("click"); i.data("kendoTreeView") != undefined && (i.data("kendoTreeView").destroy(), i.empty()); u.data("kendoTreeView") != undefined && (u.data("kendoTreeView").destroy(), u.empty()); p.windowNo = null; gt = null; c = 0; yt = 0; d = 0; ei = ""; di = 0; tt.remove(); h.remove(); o.remove(); f.remove(); b.remove(); it.remove(); rt.remove(); ut.remove(); ft.remove(); tt = null; h = null; o = null; f = null; b = null; it = null; rt = null; ut = null; ft = null; a = null; $cmbWarehouse = null; st.remove(); l.remove(); oi.remove(); k.remove(); ui.remove(); st = null; l = null; oi = null; k = null; ui = null; v.remove(); y.remove(); g.remove(); lt.remove(); at.remove(); wt.remove(); si.remove(); pt.remove(); v = null; y = null; g = null; lt = null; at = null; wt = null; si = null; pt = null; nr = null; hr = null; cr = null; $btnAddChildNode = null; fi.remove(); fi = null; r.remove(); r = null; hi = null; rf = null; uu.remove(); fu.remove(); ot.remove(); s.remove(); ni.remove(); i.remove(); ri.remove(); u.remove(); uu = null; fu = null; ot = null; s = null; pt = null; ni = null; i = null; ri = null; u = null; ct.remove(); ct = null; p.frame = null; p = null }; this.lockUI = function () { }; this.unlockUI = function () { }; this.sizeChanged = function (n, t) { uf = n; ff = t; this.formSizeChanged(n, t) } } i.prototype.refresh = function () { this.formSizeChanged() }; i.prototype.sizeChanged = function (n, t) { this.sizeChanged(n, t) }; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; t.setTitle("VA003_OrgStructure"); t.hideHeader(!0); this.frame.getContentGrid().append(this.getRoot()); this.initializeComponent() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame = null }; n.OrgStructure = i }(VA003, jQuery), function (n, t) { n.OrgStructure.AddNode = function (n, i, r, u, f) { function w() { h.append(t('<div class="VA003-form-data"><\/div>').append("<label>" + VIS.Msg.getMsg("SearchKey") + "<\/label>").append(v)); h.append(t('<div class="VA003-form-data"><\/div>').append("<label>" + VIS.Msg.getMsg("Name") + "<\/label>").append(o)); l = t('<button class="VIS_Pref_btn-2"  style="margin-top:0px;margin-bottom:0px;margin-right:10px;margin-left:10px;">' + VIS.Msg.getMsg("OK") + "<\/button>"); a = t('<button class="VIS_Pref_btn-2"  style="margin-bottom:0px;margin-top:0px;">' + VIS.Msg.getMsg("Cancel") + "<\/button>"); s.append(h).append(a).append(l); l.on("click", d); a.on("click", g) } function b() { $bsyDiv = t("<div>"); $bsyDiv.css("position", "absolute"); $bsyDiv.css("bottom", "0"); $bsyDiv.css("background", "url('" + VIS.Application.contextUrl + "Areas/VIS/Images/busy.gif') no-repeat"); $bsyDiv.css("background-position", "center center"); $bsyDiv.css("width", "97%"); $bsyDiv.css("height", "98%"); $bsyDiv.css("text-align", "center"); $bsyDiv.css("z-index", "1000"); $bsyDiv[0].style.visibility = "hidden"; s.append($bsyDiv) } function k() { o.on("change", function () { o.val().length > 0 ? o.css("background-color", "white") : o.css("background-color", "#ffb6c1") }) } function d(n) { if (o.val().trim().length == 0) return VIS.ADialog.info("EnterName"), n.preventDefault(), !1; $bsyDiv[0].style.visibility = "visible"; window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "OrgStructure/AddOrgNode", async: !1, data: { treeID: y, name: VIS.Utility.encodeText(o.val().trim()), description: "", value: VIS.Utility.encodeText(v.val().trim()), windowNo: p, parentID: r }, success: function (t) { var r = JSON.parse(t); if (r.ErrorMsg != null && r.ErrorMsg.length > 0) return VIS.ADialog.error(r.ErrorMsg), $bsyDiv[0].style.visibility = "hidden", n.preventDefault(), !1; i.addNodeToTree(r.Tree); $bsyDiv[0].style.visibility = "hidden"; e.close() }, error: function () { $bsyDiv[0].style.visibility = "hidden" } }) }, 20) } function g() { e.close() } var y = n, p = i.windowNo, s = t("<div>"), h = t('<div style="width:100%" class="VA003-form-top-fields">'), e = null, c = this, l = null, a = null, v = t('<input maxlength="' + f + '" type="text" data-name="searchkey">'), o = t('<input style="background-color:#ffb6c1"  maxlength="' + u + '"  type="text" data-name="name">'); b(); this.show = function () { e = new VIS.ChildDialog; e.setContent(s); e.setWidth(340); e.setHeight(297); e.setTitle(VIS.Msg.getMsg("VA003_AddNode")); e.setModal(!0); e.onClose = function () { c.onClose && c.onClose(); c.dispose() }; e.show(); e.hideButtons(); k(); w() }; this.dispose = function () { s.remove(); s = null; h.remove(); h = null; e = null; c = null } } }(VA003, jQuery), function (n, t) { n.OrgStructure.info = function (n) { function r() { i.append(t('<ul class="VA003-topRight-icons VA003-infoRoot-CloseInfo"><li><a style="float: initial;padding:0px"><span style="height:29px;width:29px" class="VA003-AddNode-infoCloseicon"><\/span><\/a><\/li><\/ul>')); t(i.find(".VA003-infoRoot-CloseInfo")).on("click", function () { n() }) } var i = t('<div class="VA003-infoRoot">'); this.init = function () { r() }; this.getRoot = function () { return i } } }(VA003, jQuery)